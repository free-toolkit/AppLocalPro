<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="GastroNeo: app de restaurante del futuro con reservas inteligentes, men√∫ digital, sistema de fidelizaci√≥n GastroPass y gesti√≥n para camareros.">
    <title>GastroNeo ‚Äì Restaurante del Futuro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Rajdhani:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/shared.css">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF2A6D">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GastroNeo">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" href="icon-192.png">

    <style>
        /* === Splash Screen (sin cambios) === */
        #splashScreen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #1A0A10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
            overflow: hidden;
        }
        .splash-logo {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #FF2A6D, #FFD300);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 0 30px rgba(255, 42, 109, 0.6);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .splash-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            color: #00F0FF;
            text-shadow: 0 0 10px rgba(0, 240, 255, 0.7);
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        body {
            background: #1A0A10;
            color: #FFD6E0;
            overflow-x: hidden;
        }
        .app-container {
            max-width: 500px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #220F18;
            border: 1px solid #FF2A6D;
            box-shadow: 0 0 30px rgba(255, 42, 109, 0.4);
            position: relative;
            overflow: hidden;
        }

        .app-header {
            background: linear-gradient(135deg, #FF2A6D, #FFD300);
            padding: 1.2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .app-header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            position: relative;
            z-index: 1;
            text-shadow: 0 0 10px rgba(255,255,255,0.7);
        }

        .app-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: rgba(34, 15, 24, 0.7);
        }

        .view { display: none; }
        .view.active { display: block; }

        /* === Estilos existentes (resumidos para brevedad) === */
        .auth-section, .user-profile, .menu-header, .category-title,
        .menu-item, .menu-item-content, .menu-item-title, .menu-item-desc,
        .menu-item-meta, .add-btn, .rewards-header, .gastropass-card,
        .level-badge, .progress-bar, .progress-fill, .benefits-section,
        .rewards-section, .reward-item, .owner-header, .summary-card,
        .alerts-section, .waiting-section, .btn-neo, .form-control,
        .form-group label, .app-nav, .nav-item, .download-btn {
            /* Tus estilos originales se mantienen intactos */
        }

        /* === NUEVO: Estilos para camareros === */
        .table-card {
            height: 100px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            font-family: 'Orbitron', sans-serif;
            border: 2px solid;
        }
        .table-card.free {
            background: rgba(40, 20, 30, 0.6);
            border-color: #333;
            color: #888;
        }
        .table-card.occupied {
            background: linear-gradient(135deg, #2A1018, #3A1525);
            border-color: #FF2A6D;
            color: #FFD300;
        }
        .table-card.reserved {
            background: rgba(30, 15, 25, 0.7);
            border-color: #FFD300;
            border-style: dashed;
            color: #FFD300;
        }
        .table-number {
            font-size: 1.4rem;
            font-weight: 700;
        }
        .table-status {
            font-size: 0.75rem;
            margin-top: 0.2rem;
        }
        .table-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FF2A6D;
            color: white;
            font-size: 0.65rem;
            padding: 0.2rem 0.4rem;
            border-radius: 10px;
        }

        /* Botones de pago */
        .payment-methods {
            display: flex;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        .payment-btn {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            cursor: pointer;
            font-size: 1.1rem;
        }
        .btn-cash { background: linear-gradient(135deg, #00F0FF, #00B8FF); color: #0D0916; }
        .btn-card { background: linear-gradient(135deg, #6E00FF, #3A00B8); color: white; }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splashScreen">
        <div class="splash-logo">
            <img src="Logo GASTRONEO - Opci√≥n 3.jpg" alt="GastroNeo" style="width:100%;height:100%;border-radius:50%;">
        </div>
        <div class="splash-text">GASTRONEO</div>
    </div>

    <div class="app-container">
        <!-- === Vistas existentes: home, booking, menu, rewards, ownerDashboard === -->
        <!-- ... (mantenemos todo tu HTML original hasta el cierre de .app-content) ... -->

        <!-- === NUEVO: Vista Login Camarero === -->
        <div id="waiterLoginView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-user-tie"></i> Camarero</h1>
            </div>
            <div class="app-content" style="text-align:center;">
                <div style="margin:2rem 0;">
                    <i class="fas fa-key" style="font-size:3rem;color:#FF2A6D;"></i>
                    <div style="margin-top:1rem;font-family:'Rajdhani';font-size:1.1rem;">Ingresa tu PIN</div>
                </div>
                <input type="password" id="waiterPin" class="form-control" placeholder="****" style="max-width:200px;margin:0 auto;">
                <button class="btn-neo btn-primary" onclick="loginWaiter()" style="margin-top:1.5rem;">
                    Ingresar
                </button>
                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;margin-top:1rem;" onclick="showView('homeView')">
                    ‚Üê Volver
                </button>
            </div>
        </div>

        <!-- === NUEVO: Vista Mesas (Camarero) === -->
        <div id="waiterTablesView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-concierge-bell"></i> Mesas</h1>
            </div>
            <div class="app-content">
                <div id="tablesGrid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 1rem;"></div>
                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;margin-top:1.5rem;" onclick="logoutWaiter()">
                    ‚Üê Cerrar Sesi√≥n
                </button>
            </div>
        </div>

        <!-- === NUEVO: Vista Pedido (Camarero) === -->
        <div id="waiterOrderView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-clipboard-list"></i> Mesa <span id="orderTableNum">1</span></h1>
            </div>
            <div class="app-content">
                <div class="form-group">
                    <label>Comensales</label>
                    <select id="guestsCount" class="form-control">
                        <option>1</option><option>2</option><option>3</option><option>4</option>
                    </select>
                </div>

                <!-- Men√∫ simplificado -->
                <div class="category-section">
                    <div class="category-title">ENTRADAS</div>
                    <div class="menu-item" style="margin-bottom:0.8rem;">
                        <div class="menu-item-content" style="padding:0.6rem;">
                            <div class="menu-item-title">Tartar de At√∫n</div>
                            <div class="menu-item-meta">
                                <span>üí∞ ‚Ç¨16.50</span>
                                <button class="add-btn" style="padding:0.3rem 0.6rem;font-size:0.8rem;" onclick="addItemToOrder('Tartar de At√∫n', 16.50)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="menu-item" style="margin-bottom:0.8rem;">
                        <div class="menu-item-content" style="padding:0.6rem;">
                            <div class="menu-item-title">Bruschetta</div>
                            <div class="menu-item-meta">
                                <span>üí∞ ‚Ç¨9.90</span>
                                <button class="add-btn" style="padding:0.3rem 0.6rem;font-size:0.8rem;" onclick="addItemToOrder('Bruschetta', 9.90)">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-title">PLATOS FUERTES</div>
                    <div class="menu-item" style="margin-bottom:0.8rem;">
                        <div class="menu-item-content" style="padding:0.6rem;">
                            <div class="menu-item-title">Pasta Carbonara</div>
                            <div class="menu-item-meta">
                                <span>üí∞ ‚Ç¨18.99</span>
                                <button class="add-btn" style="padding:0.3rem 0.6rem;font-size:0.8rem;" onclick="addItemToOrder('Pasta Carbonara', 18.99)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="menu-item" style="margin-bottom:0.8rem;">
                        <div class="menu-item-content" style="padding:0.6rem;">
                            <div class="menu-item-title">Risotto de Trufa</div>
                            <div class="menu-item-meta">
                                <span>üí∞ ‚Ç¨24.00</span>
                                <button class="add-btn" style="padding:0.3rem 0.6rem;font-size:0.8rem;" onclick="addItemToOrder('Risotto de Trufa', 24.00)">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-title">POSTRES</div>
                    <div class="menu-item" style="margin-bottom:0.8rem;">
                        <div class="menu-item-content" style="padding:0.6rem;">
                            <div class="menu-item-title">Tiramis√∫</div>
                            <div class="menu-item-meta">
                                <span>üí∞ ‚Ç¨8.99</span>
                                <button class="add-btn" style="padding:0.3rem 0.6rem;font-size:0.8rem;" onclick="addItemToOrder('Tiramis√∫', 8.99)">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resumen del pedido -->
                <div id="orderSummary" style="margin-top:1.5rem; background:rgba(30,10,15,0.6); padding:1rem; border-radius:12px; display:none;">
                    <h3 style="font-family:'Rajdhani';color:#FFD300;margin:0 0 0.8rem;">Pedido Actual</h3>
                    <div id="orderItemsList"></div>
                    <div style="font-family:'Orbitron';color:#FF2A6D;font-size:1.2rem;margin-top:0.8rem;">
                        Total: ‚Ç¨<span id="orderTotal">0.00</span>
                    </div>
                </div>

                <button class="btn-neo btn-primary" onclick="sendOrderToKitchen()" style="margin-top:1rem; display:none;" id="sendOrderBtn">
                    <i class="fas fa-fire"></i> Enviar a Cocina
                </button>
                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;" onclick="showView('waiterTablesView')">
                    ‚Üê Volver a Mesas
                </button>
            </div>
        </div>

        <!-- === NUEVO: Vista Cobro (Camarero) === -->
        <div id="paymentView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-cash-register"></i> Cobrar Mesa <span id="paymentTableNum">1</span></h1>
            </div>
            <div class="app-content">
                <div style="background:rgba(30,10,15,0.6); padding:1rem; border-radius:12px; margin-bottom:1.5rem;">
                    <h3 style="font-family:'Rajdhani';color:#FFD300;margin:0 0 0.8rem;">Resumen</h3>
                    <div id="paymentOrderItems"></div>
                    <div style="font-family:'Orbitron';color:#FF2A6D;font-size:1.3rem;margin-top:0.8rem;">
                        Total: ‚Ç¨<span id="paymentTotal">0.00</span>
                    </div>
                </div>

                <div class="payment-methods">
                    <button class="payment-btn btn-cash" onclick="processPayment('cash')">
                        <i class="fas fa-money-bill-wave"></i><br>Efectivo
                    </button>
                    <button class="payment-btn btn-card" onclick="processPayment('card')">
                        <i class="fas fa-credit-card"></i><br>Tarjeta
                    </button>
                </div>

                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;" onclick="showView('waiterTablesView')">
                    ‚Üê Volver
                </button>
            </div>
        </div>
    </div>

    <!-- Navegaci√≥n inferior -->
    <div class="app-nav">
        <a href="#" class="nav-item active" onclick="showView('homeView'); return false;">
            <i class="fas fa-home"></i>
            <span>Inicio</span>
        </a>
        <a href="#" class="nav-item" onclick="showView('bookingView'); return false;">
            <i class="fas fa-calendar"></i>
            <span>Reservas</span>
        </a>
        <a href="#" class="nav-item" onclick="showView('menuView'); return false;">
            <i class="fas fa-book"></i>
            <span>Men√∫</span>
        </a>
    </div>

    <!-- Bot√≥n Descarga App -->
    <button class="download-btn" onclick="installApp()">
        <i class="fas fa-download"></i>
    </button>

    <script>
        // === Estado global ===
        let currentOrder = null;
        let currentPaymentOrder = null;

        // === Funciones existentes (resumidas) ===
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.getElementById('splashScreen').style.display = 'none';
                document.querySelector('.app-container').style.display = 'flex';
                renderAuthOrProfile();
                renderTablesGrid(); // Inicializar mesas
            }, 2000);
        });

        function installApp() { /* ... */ }
        function getBusinessData() { /* ... */ }
        function redeemReward(cost, item) { /* ... */ }
        function loadOwnerDashboard() { /* ... */ }
        function verifyAllOrders() { /* ... */ }
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            if (viewId === 'ownerDashboard') loadOwnerDashboard();
        }
        function openOwnerAccess() { /* ... */ }
        function logoutOwner() { /* ... */ }
        function confirmBooking() { /* ... */ }
        function renderAuthOrProfile() { /* ... */ }
        function showSignupModal() { /* ... */ }
        function showLoginModal() { /* ... */ }

        // === NUEVO: Sistema de Camareros ===
        function loginWaiter() {
            const pin = document.getElementById('waiterPin').value;
            if (pin === "9876") { // PIN demo
                localStorage.setItem('gastroneo_waiter', JSON.stringify({ role: 'waiter' }));
                showView('waiterTablesView');
            } else {
                alert("PIN incorrecto.");
            }
        }

        function logoutWaiter() {
            localStorage.removeItem('gastroneo_waiter');
            showView('homeView');
        }

        function renderTablesGrid() {
            const grid = document.getElementById('tablesGrid');
            grid.innerHTML = '';
            // Simulamos 12 mesas
            for (let i = 1; i <= 12; i++) {
                const status = i <= 4 ? 'occupied' : 'free';
                const card = document.createElement('div');
                card.className = `table-card ${status}`;
                card.innerHTML = `
                    <div class="table-number">${i}</div>
                    <div class="table-status">${status === 'free' ? 'Libre' : 'Ocupada'}</div>
                    ${status === 'occupied' ? '<div class="table-badge">Pedido</div>' : ''}
                `;
                card.onclick = () => openOrderOrPayment(i, status);
                grid.appendChild(card);
            }
        }

        function openOrderOrPayment(tableNum, status) {
            if (status === 'free') {
                // Nueva orden
                currentOrder = { table: tableNum, guests: 1, items: [], total: 0 };
                document.getElementById('orderTableNum').textContent = tableNum;
                document.getElementById('guestsCount').value = "1";
                document.getElementById('orderSummary').style.display = 'none';
                document.getElementById('sendOrderBtn').style.display = 'none';
                showView('waiterOrderView');
            } else {
                // Cobrar mesa ocupada
                currentPaymentOrder = {
                    table: tableNum,
                    items: [
                        { name: "Risotto de Trufa", price: 24.00 },
                        { name: "Tartar de At√∫n", price: 16.50 }
                    ],
                    total: 40.50
                };
                document.getElementById('paymentTableNum').textContent = tableNum;
                renderPaymentSummary();
                showView('paymentView');
            }
        }

        function addItemToOrder(name, price) {
            if (!currentOrder) return;
            currentOrder.items.push({ name, price });
            currentOrder.total += price;
            document.getElementById('orderSummary').style.display = 'block';
            document.getElementById('sendOrderBtn').style.display = 'block';
            renderOrderSummary();
        }

        function renderOrderSummary() {
            const list = document.getElementById('orderItemsList');
            const totalEl = document.getElementById('orderTotal');
            list.innerHTML = currentOrder.items.map(item =>
                `<div style="display:flex;justify-content:space-between;font-size:0.9rem;">
                    <span>${item.name}</span>
                    <span>‚Ç¨${item.price.toFixed(2)}</span>
                </div>`
            ).join('');
            totalEl.textContent = currentOrder.total.toFixed(2);
        }

        function sendOrderToKitchen() {
            if (!currentOrder || currentOrder.items.length === 0) {
                alert("A√±ade al menos un plato.");
                return;
            }
            // Guardar en "base de datos" (localStorage)
            const orders = JSON.parse(localStorage.getItem('gastroneo_orders') || '[]');
            const newOrder = {
                id: 'ord_' + Date.now(),
                table: currentOrder.table,
                items: currentOrder.items,
                total: currentOrder.total,
                status: 'sent',
                timestamp: new Date().toISOString()
            };
            orders.push(newOrder);
            localStorage.setItem('gastroneo_orders', JSON.stringify(orders));

            // Notificar al due√±o
            addNotification(`Nuevo pedido en mesa ${currentOrder.table}`);

            alert(`‚úÖ Pedido enviado a cocina.\nMesa ${currentOrder.table}`);
            renderTablesGrid(); // Actualizar vista
            showView('waiterTablesView');
        }

        // === NUEVO: Sistema de Cobro ===
        function renderPaymentSummary() {
            const list = document.getElementById('paymentOrderItems');
            const totalEl = document.getElementById('paymentTotal');
            list.innerHTML = currentPaymentOrder.items.map(item =>
                `<div style="display:flex;justify-content:space-between;font-size:0.9rem;">
                    <span>${item.name}</span>
                    <span>‚Ç¨${item.price.toFixed(2)}</span>
                </div>`
            ).join('');
            totalEl.textContent = currentPaymentOrder.total.toFixed(2);
        }

        function processPayment(method) {
            const transaction = {
                id: 'txn_' + Date.now(),
                table: currentPaymentOrder.table,
                amount: currentPaymentOrder.total,
                method: method,
                timestamp: new Date().toISOString(),
                deviceId: 'tablet_01'
            };

            // Guardar transacci√≥n
            const transactions = JSON.parse(localStorage.getItem('gastroneo_transactions') || '[]');
            transactions.push(transaction);
            localStorage.setItem('gastroneo_transactions', JSON.stringify(transactions));

            // Notificar al due√±o
            addNotification(`Mesa ${currentPaymentOrder.table} pagada: ‚Ç¨${currentPaymentOrder.total.toFixed(2)} (${method === 'cash' ? 'efectivo' : 'tarjeta'})`);

            alert(`‚úÖ Pago registrado (${method === 'cash' ? 'Efectivo' : 'Tarjeta'})`);
            renderTablesGrid(); // Mesa ahora libre
            showView('waiterTablesView');
        }

        function addNotification(message) {
            const notifications = JSON.parse(localStorage.getItem('gastroneo_notifications') || '[]');
            notifications.unshift({
                id: 'notif_' + Date.now(),
                message: message,
                read: false,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('gastroneo_notifications', JSON.stringify(notifications));
        }

        // === Mejora: Dashboard del Due√±o (notificaciones en vivo) ===
        function loadOwnerDashboard() {
            const data = getBusinessData();
            // ... (tu l√≥gica existente)

            // Notificaciones en vivo
            const notifications = JSON.parse(localStorage.getItem('gastroneo_notifications') || '[]');
            const alertsList = document.getElementById('alertsList');
            if (notifications.length > 0) {
                alertsList.innerHTML = notifications.slice(0, 3).map(n => `‚Ä¢ ${n.message}`).join('<br>');
                document.getElementById('alertsSection').style.display = 'block';
            }
        }
    </script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registrado'))
                    .catch(err => console.log('Error SW:', err));
            });
        }
    </script>
</body>
</html>
