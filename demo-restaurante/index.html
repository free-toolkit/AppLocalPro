<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="GastroNeo: app de restaurante del futuro con reservas inteligentes, men√∫ digital, sistema de fidelizaci√≥n GastroPass y gesti√≥n para camareros.">
    <title>GastroNeo ‚Äì Restaurante del Futuro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Rajdhani:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF2A6D">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GastroNeo">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" href="icon-192.png">

    <style>
        /* === Estilos base === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #1A0A10;
            color: #FFD6E0;
            overflow-x: hidden;
            font-family: 'Rajdhani', sans-serif;
        }
        .app-container {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: #220F18;
            border: 1px solid #FF2A6D;
            box-shadow: 0 0 30px rgba(255, 42, 109, 0.4);
            position: relative;
        }
        .app-header {
            background: linear-gradient(135deg, #FF2A6D, #FFD300);
            padding: 1.2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        .app-header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            position: relative;
            z-index: 1;
            text-shadow: 0 0 10px rgba(255,255,255,0.7);
        }
        .app-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: rgba(34, 15, 24, 0.7);
        }
        .view { 
            display: none; 
            flex: 1;
            flex-direction: column;
        }
        .view.active { 
            display: flex !important;
        }

        /* === Splash Screen === */
        #splashScreen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #1A0A10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
            overflow: hidden;
        }
        .splash-logo {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #FF2A6D, #FFD300);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 0 30px rgba(255, 42, 109, 0.6);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .splash-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            color: #00F0FF;
            text-shadow: 0 0 10px rgba(0, 240, 255, 0.7);
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* === Botones universales === */
        .btn-neo {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-family: 'Rajdhani', sans-serif;
            cursor: pointer;
            margin: 0.8rem 0;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .btn-primary { background: linear-gradient(135deg, #FF2A6D, #D10047); color: white; }
        .btn-gold { background: linear-gradient(135deg, #FFD300, #FF9A00); color: #333; }
        .btn-verify { background: linear-gradient(135deg, #00F0FF, #6E00FF); color: #0D0916; }
        .btn-success { background: linear-gradient(135deg, #00D100, #009900); color: white; }
        .btn-scan { background: linear-gradient(135deg, #00F0FF, #0099FF); color: #0D0916; }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            background: #1A1030;
            color: #FFD6E0;
            border: 1px solid #FF2A6D;
            border-radius: 8px;
            font-family: 'Rajdhani', sans-serif;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #D0B0C0;
        }

        /* === Navegaci√≥n inferior === */
        .app-nav {
            display: flex;
            justify-content: space-around;
            background: rgba(10, 7, 10, 0.9);
            border-top: 1px solid #FF2A6D;
            padding: 0.8rem 0;
            backdrop-filter: blur(5px);
            flex-shrink: 0;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #E0C0D0;
            text-decoration: none;
            font-size: 0.8rem;
            font-family: 'Rajdhani', sans-serif;
            transition: color 0.3s ease;
            position: relative;
        }
        .nav-item.active, .nav-item:hover {
            color: #FFD300;
        }
        .nav-item i { font-size: 1.4rem; margin-bottom: 0.3rem; }

        /* === Bot√≥n de descarga === */
        .download-btn {
            position: fixed;
            bottom: 70px;
            right: 10px;
            background: linear-gradient(135deg, #FF2A6D, #D10047);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 0 15px rgba(255, 42, 109, 0.5);
            z-index: 1000;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .download-btn:hover {
            transform: scale(1.1);
        }

        /* === Men√∫ Digital ‚Äì Tarjetas Optimizadas === */
        .menu-category {
            margin-bottom: 1.5rem;
        }
        .menu-category-title {
            font-family: 'Orbitron', sans-serif;
            color: #FF2A6D;
            font-size: 1.25rem;
            margin: 1.2rem 0 0.9rem;
            padding-bottom: 0.4rem;
            border-bottom: 1px solid #FF2A6D;
        }
        .menu-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        .menu-card {
            background: rgba(25, 10, 15, 0.65);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #3A1525;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            height: auto;
        }
        .menu-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 42, 109, 0.25);
        }
        .menu-card-img {
            height: 120px;
            overflow: hidden;
            position: relative;
        }
        .menu-card-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }
        .menu-card:hover .menu-card-img img {
            transform: scale(1.05);
        }
        .menu-card-body {
            padding: 0.8rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .menu-card-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            color: #FFD300;
            margin: 0 0 0.4rem;
            line-height: 1.2;
        }
        .menu-card-desc {
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.85rem;
            color: #F0D0E0;
            margin: 0 0 0.8rem;
            line-height: 1.4;
            flex: 1;
        }
        .menu-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }
        .menu-card-price {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            color: #FF2A6D;
            font-size: 1rem;
        }
        .menu-card-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF2A6D, #D10047);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        .menu-card-btn:hover {
            transform: scale(1.1);
        }

        /* === Carrito de Compras === */
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            background: rgba(30, 10, 15, 0.6);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border: 1px solid #3A1525;
        }
        .cart-item-info {
            flex: 1;
        }
        .cart-item-name {
            font-weight: 600;
            color: #FFD300;
            font-size: 0.95rem;
        }
        .cart-item-price {
            color: #FF2A6D;
            font-size: 0.9rem;
        }
        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .quantity-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #FF2A6D;
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .cart-total {
            background: linear-gradient(135deg, #2A1018, #3A1525);
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
            text-align: center;
            border: 1px solid #FF2A6D;
        }
        .cart-total-amount {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: #FFD300;
            margin: 0.5rem 0;
        }

        /* === Checkout y Pagos === */
        .payment-methods {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.8rem;
            margin: 1.5rem 0;
        }
        .payment-btn {
            padding: 1.2rem;
            border: none;
            border-radius: 12px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            transition: all 0.3s ease;
        }
        .btn-cash { 
            background: linear-gradient(135deg, #00F0FF, #00B8FF); 
            color: #0D0916; 
        }
        .btn-card { 
            background: linear-gradient(135deg, #6E00FF, #3A00B8); 
            color: white; 
        }
        .btn-paypal { 
            background: linear-gradient(135deg, #0070BA, #009CDE); 
            color: white; 
        }
        .payment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* === GastroPass ‚Äì Botones de canjeo peque√±os y elegantes === */
        .reward-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid #44202A;
        }
        .reward-item:last-child {
            border: none;
        }
        .reward-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFD300, #FF9A00);
            color: #220F18;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        .reward-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 8px rgba(255, 211, 0, 0.6);
        }

        /* === Camarero === */
        .table-card {
            height: 80px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            font-family: 'Orbitron', sans-serif;
            border: 2px solid;
            transition: all 0.3s ease;
        }
        .table-card.free {
            background: rgba(40, 20, 30, 0.6);
            border-color: #333;
            color: #888;
        }
        .table-card.occupied {
            background: linear-gradient(135deg, #2A1018, #3A1525);
            border-color: #FF2A6D;
            color: #FFD300;
        }
        .table-number {
            font-size: 1.2rem;
            font-weight: 700;
        }
        .table-status {
            font-size: 0.7rem;
            margin-top: 0.2rem;
        }
        .table-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FF2A6D;
            color: white;
            font-size: 0.65rem;
            padding: 0.2rem 0.4rem;
            border-radius: 10px;
        }

        /* === Badge del Carrito === */
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #FF2A6D;
            color: white;
            font-size: 0.7rem;
            padding: 0.2rem 0.4rem;
            border-radius: 50%;
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* === Estados vac√≠os === */
        .empty-state {
            text-align: center;
            padding: 2rem 1rem;
            color: #D0B0C0;
        }
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #FF2A6D;
        }

        /* === QR Scanner Styles === */
        .scanner-container {
            background: rgba(0, 240, 255, 0.1);
            border: 2px dashed #00F0FF;
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
            text-align: center;
        }
        .scanner-icon {
            color: #00F0FF;
            font-size: 5rem;
            margin-bottom: 1rem;
        }

        /* === NOTIFICACIONES INTELIGENTES === */
        .notification-container {
            position: fixed;
            top: 80px;
            right: 10px;
            z-index: 1000;
            max-width: 300px;
        }
        .notification {
            background: #1A0A10;
            border-left: 4px solid;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: slideInRight 0.3s ease;
        }
        .notification.warning { border-color: #FFD300; }
        .notification.danger { border-color: #FF2A6D; }
        .notification.success { border-color: #00F0FF; }
        .notification.info { border-color: #6E00FF; }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* === SISTEMA DE GAMIFICACI√ìN LABORAL === */
        .leaderboard {
            background: rgba(20, 5, 10, 0.8);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            border: 1px solid #FF2A6D;
        }
        .leaderboard-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: #FFD300;
            text-align: center;
            margin-bottom: 1rem;
        }
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }
        .rank-badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            margin-right: 1rem;
        }
        .rank-diamante { background: linear-gradient(135deg, #00FFFF, #0080FF); }
        .rank-oro { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .rank-plata { background: linear-gradient(135deg, #E5E4E2, #A8A8A8); }
        .rank-bronce { background: linear-gradient(135deg, #CD7F32, #8B4513); }

        /* === ACTIVIDAD EN VIVO === */
        .activity-feed {
            max-height: 200px;
            overflow-y: auto;
            margin: 1rem 0;
        }
        .activity-item {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            font-size: 0.8rem;
            border-left: 3px solid;
            animation: fadeInUp 0.5s ease;
        }
        .activity-positive { border-color: #00F0FF; }
        .activity-negative { border-color: #FF2A6D; }
        .activity-neutral { border-color: #D0B0C0; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splashScreen">
        <div class="splash-logo">
            <img src="Logo GASTRONEO - Opci√≥n 3.jpg" alt="GastroNeo" style="width:100%;height:100%;border-radius:50%;">
        </div>
        <div class="splash-text">GASTRONEO</div>
    </div>

    <!-- Sistema de Notificaciones Inteligentes -->
    <div class="notification-container" id="notificationContainer"></div>

    <div class="app-container">
        <!-- Home View -->
        <div id="homeView" class="view active">
            <div class="app-header">
                <h1>GASTRONEO</h1>
            </div>
            <div class="app-content">
                <div style="text-align:center;margin-bottom:1.5rem;">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTGwjDuHhDnYwyI7QyXJn0e1rPwH3aWt6PkRw&s" 
                         alt="Equipo GastroNeo"
                         style="width:100%;max-height:180px;object-fit:cover;border-radius:12px;">
                    <div style="font-family:'Rajdhani';font-size:1rem;color:#FFD300;text-align:center;margin:1rem 0;font-style:italic;">
                        "M√°s del 70% de los clientes eligen restaurantes con equipo visible y cercano."
                    </div>
                </div>

                <div id="authOrProfile"></div>

                <button class="btn-neo btn-primary" onclick="showView('bookingView')">
                    <i class="fas fa-utensils"></i> Reservar Mesa
                </button>
                <button class="btn-neo btn-scan" onclick="showView('qrScannerView')">
                    <i class="fas fa-qrcode"></i> Escanear Mesa
                </button>
                <button class="btn-neo btn-gold" onclick="showView('menuView')">
                    <i class="fas fa-book-open"></i> Men√∫ Digital
                </button>
                <button class="btn-neo btn-primary" onclick="showView('rewardsView')">
                    <i class="fas fa-coins"></i> Mi GastroPass
                </button>
                <button class="btn-neo" style="background:rgba(255,42,109,0.2);color:#FF2A6D;border:1px solid #FF2A6D;" onclick="openOwnerAccess()">
                    <i class="fas fa-user-lock"></i> Acceso Due√±o
                </button>
                <button class="btn-neo" style="background:rgba(0,240,255,0.2);color:#00F0FF;border:1px solid #00F0FF;" onclick="showView('waiterLoginView')">
                    <i class="fas fa-user-tie"></i> Camarero
                </button>

                <!-- Actividad en Vivo -->
                <div class="activity-feed" id="liveActivityFeed"></div>
            </div>
        </div>

        <!-- QR Scanner View -->
        <div id="qrScannerView" class="view">
            <div class="app-header">
                <h1>üì± Escanear QR Mesa</h1>
            </div>
            <div class="app-content" style="text-align: center;">
                <div style="margin: 2rem 0;">
                    <i class="fas fa-qrcode" style="font-size: 4rem; color: #00F0FF; margin-bottom: 1rem;"></i>
                    <div style="font-family: 'Rajdhani'; font-size: 1.1rem; color: #FFD300; margin-bottom: 1.5rem;">
                        Escanea el c√≥digo QR de tu mesa
                    </div>
                </div>
                
                <div class="scanner-container">
                    <div class="scanner-icon">
                        <i class="fas fa-camera"></i>
                    </div>
                    <div style="color: #D0B0C0; margin-bottom: 1.5rem;">
                        C√°mara lista para escanear...
                    </div>
                    <button class="btn-neo btn-scan" onclick="simulateQRScan()">
                        <i class="fas fa-camera"></i> Simular Escaneo
                    </button>
                </div>

                <div style="background: rgba(255, 42, 109, 0.1); border-radius: 12px; padding: 1rem; margin: 1.5rem 0;">
                    <div style="color: #FFD300; font-family: 'Rajdhani'; margin-bottom: 0.5rem;">üí° ¬øC√≥mo escanear?</div>
                    <div style="color: #D0B0C0; font-size: 0.9rem;">
                        1. Enfoca el c√≥digo QR de tu mesa<br>
                        2. La app detectar√° autom√°ticamente<br>
                        3. ¬°Accede al men√∫ digital!
                    </div>
                </div>

                <button class="btn-neo" style="background: #3A1525; color: #E0C0D0;" onclick="showView('homeView')">
                    ‚Üê Volver
                </button>
            </div>
        </div>

        <!-- Booking View -->
        <div id="bookingView" class="view">
            <div class="app-header">
                <h1>üçΩÔ∏è Reservar Mesa</h1>
            </div>
            <div class="app-content">
                <div class="form-group">
                    <label>Nombre Completo</label>
                    <input type="text" id="clientName" class="form-control" placeholder="Ej. Carlos Ruiz">
                </div>
                <div class="form-group">
                    <label>Tel√©fono</label>
                    <input type="tel" id="clientPhone" class="form-control" placeholder="+34 600 000 000">
                </div>
                <div class="form-group">
                    <label>Fecha</label>
                    <input type="date" id="bookingDate" class="form-control">
                </div>
                <div class="form-group">
                    <label>Hora</label>
                    <select id="bookingTime" class="form-control">
                        <option value="13:00">13:00</option>
                        <option value="13:30">13:30</option>
                        <option value="14:00">14:00</option>
                        <option value="20:00">20:00</option>
                        <option value="20:30">20:30</option>
                        <option value="21:00">21:00</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Comensales</label>
                    <select id="guests" class="form-control">
                        <option>1</option><option>2</option><option>3</option><option>4</option>
                    </select>
                </div>
                <button class="btn-neo btn-primary" onclick="confirmBooking()">Confirmar Reserva</button>
                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;" onclick="showView('homeView')">‚Üê Volver</button>
            </div>
        </div>

        <!-- Men√∫ Digital ‚Äì OPTIMIZADO -->
        <div id="menuView" class="view">
            <div class="app-header">
                <h1>üìñ Men√∫ Digital</h1>
            </div>
            <div class="app-content">
                <div id="mesaInfo" style="background: rgba(0, 240, 255, 0.1); border-radius: 8px; padding: 0.8rem; margin-bottom: 1rem; display: none;">
                    <div style="color: #00F0FF; font-family: 'Orbitron'; font-size: 0.9rem;">
                        <i class="fas fa-table"></i> Mesa: <span id="currentMesa">-</span>
                    </div>
                </div>

                <div class="menu-category">
                    <h2 class="menu-category-title">ENTRADAS</h2>
                    <div class="menu-grid">
                        <div class="menu-card">
                            <div class="menu-card-img">
                                <img src="https://images.pexels.com/photos/3764643/pexels-photo-3764643.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Tartar de At√∫n" onerror="this.src='https://via.placeholder.com/300x120/2A1018/FF2A6D?text=Imagen+No+Disponible'">
                            </div>
                            <div class="menu-card-body">
                                <h3 class="menu-card-name">Tartar de At√∫n</h3>
                                <p class="menu-card-desc">At√∫n fresco con wasabi y aguacate, marinado en salsa de soja y aceite de s√©samo</p>
                                <div class="menu-card-footer">
                                    <span class="menu-card-price">‚Ç¨16.50</span>
                                    <button class="menu-card-btn" onclick="addToCart('Tartar de At√∫n', 16.50, 'https://images.pexels.com/photos/3764643/pexels-photo-3764643.jpeg')">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="menu-card">
                            <div class="menu-card-img">
                                <img src="https://images.pexels.com/photos/7049761/pexels-photo-7049761.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Bruschetta" onerror="this.src='https://via.placeholder.com/300x120/2A1018/FF2A6D?text=Imagen+No+Disponible'">
                            </div>
                            <div class="menu-card-body">
                                <h3 class="menu-card-name">Bruschetta</h3>
                                <p class="menu-card-desc">Pan tostado artesanal con tomate fresco, albahaca y aceite de oliva virgen extra</p>
                                <div class="menu-card-footer">
                                    <span class="menu-card-price">‚Ç¨9.90</span>
                                    <button class="menu-card-btn" onclick="addToCart('Bruschetta', 9.90, 'https://images.pexels.com/photos/7049761/pexels-photo-7049761.jpeg')">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="menu-category">
                    <h2 class="menu-category-title">PLATOS FUERTES</h2>
                    <div class="menu-grid">
                        <div class="menu-card">
                            <div class="menu-card-img">
                                <img src="https://images.pexels.com/photos/1199381/pexels-photo-1199381.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Pasta Carbonara" onerror="this.src='https://via.placeholder.com/300x120/2A1018/FF2A6D?text=Imagen+No+Disponible'">
                            </div>
                            <div class="menu-card-body">
                                <h3 class="menu-card-name">Pasta Carbonara</h3>
                                <p class="menu-card-desc">Pasta fresca con salsa cremosa de panceta, huevo y queso pecorino</p>
                                <div class="menu-card-footer">
                                    <span class="menu-card-price">‚Ç¨18.99</span>
                                    <button class="menu-card-btn" onclick="addToCart('Pasta Carbonara', 18.99, 'https://images.pexels.com/photos/1199381/pexels-photo-1199381.jpeg')">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="menu-card">
                            <div class="menu-card-img">
                                <img src="https://images.pexels.com/photos/1624487/pexels-photo-1624487.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Risotto de Trufa" onerror="this.src='https://via.placeholder.com/300x120/2A1018/FF2A6D?text=Imagen+No+Disponible'">
                            </div>
                            <div class="menu-card-body">
                                <h3 class="menu-card-name">Risotto de Trufa</h3>
                                <p class="menu-card-desc">Arroz arb√≥reo cremoso con trufa negra fresca y queso parmesano</p>
                                <div class="menu-card-footer">
                                    <span class="menu-card-price">‚Ç¨24.00</span>
                                    <button class="menu-card-btn" onclick="addToCart('Risotto de Trufa', 24.00, 'https://images.pexels.com/photos/1624487/pexels-photo-1624487.jpeg')">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="menu-category">
                    <h2 class="menu-category-title">POSTRES</h2>
                    <div class="menu-grid">
                        <div class="menu-card">
                            <div class="menu-card-img">
                                <img src="https://images.pexels.com/photos/733857/pexels-photo-733857.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Tiramis√∫" onerror="this.src='https://via.placeholder.com/300x120/2A1018/FF2A6D?text=Imagen+No+Disponible'">
                            </div>
                            <div class="menu-card-body">
                                <h3 class="menu-card-name">Tiramis√∫</h3>
                                <p class="menu-card-desc">Capas de bizcocho de soletilla empapado en caf√© y crema de mascarpone</p>
                                <div class="menu-card-footer">
                                    <span class="menu-card-price">‚Ç¨8.99</span>
                                    <button class="menu-card-btn" onclick="addToCart('Tiramis√∫', 8.99, 'https://images.pexels.com/photos/733857/pexels-photo-733857.jpeg')">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;margin-top:1.5rem;" onclick="showView('homeView')">‚Üê Volver</button>
            </div>
        </div>

        <!-- Vista del Carrito -->
        <div id="cartView" class="view">
            <div class="app-header">
                <h1>üõí Mi Carrito</h1>
            </div>
            <div class="app-content">
                <div id="mesaInfoCart" style="background: rgba(0, 240, 255, 0.1); border-radius: 8px; padding: 0.8rem; margin-bottom: 1rem; display: none;">
                    <div style="color: #00F0FF; font-family: 'Orbitron'; font-size: 0.9rem;">
                        <i class="fas fa-table"></i> Mesa: <span id="currentMesaCart">-</span>
                    </div>
                </div>

                <div id="cartItemsContainer">
                    <!-- Los items del carrito se cargan din√°micamente -->
                </div>
                
                <div id="emptyCart" class="empty-state" style="display: none;">
                    <i class="fas fa-shopping-cart"></i>
                    <h3>Tu carrito est√° vac√≠o</h3>
                    <p>¬°A√±ade algunos productos deliciosos!</p>
                </div>

                <div id="cartSummary" style="display: none;">
                    <div class="cart-total">
                        <div>Total del Pedido</div>
                        <div class="cart-total-amount" id="cartTotalAmount">‚Ç¨0.00</div>
                    </div>
                    
                    <button class="btn-neo btn-success" onclick="showView('checkoutView')">
                        <i class="fas fa-credit-card"></i> Proceder al Pago
                    </button>
                </div>

                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;" onclick="showView('menuView')">
                    ‚Üê Seguir Comprando
                </button>
            </div>
        </div>

        <!-- Vista de Checkout -->
        <div id="checkoutView" class="view">
            <div class="app-header">
                <h1>üí≥ Checkout</h1>
            </div>
            <div class="app-content">
                <div class="form-group">
                    <label>Nombre Completo</label>
                    <input type="text" id="checkoutName" class="form-control" placeholder="Como aparece en la tarjeta">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="checkoutEmail" class="form-control" placeholder="tu@email.com">
                </div>
                <div class="form-group">
                    <label>Tel√©fono</label>
                    <input type="tel" id="checkoutPhone" class="form-control" placeholder="+34 600 000 000">
                </div>

                <div style="background:rgba(30,10,15,0.6); padding:1rem; border-radius:12px; margin:1.5rem 0;">
                    <h3 style="font-family:'Rajdhani';color:#FFD300;margin:0 0 0.8rem;">Resumen del Pedido</h3>
                    <div id="checkoutOrderItems"></div>
                    <div style="font-family:'Orbitron';color:#FF2A6D;font-size:1.3rem;margin-top:0.8rem;">
                        Total: ‚Ç¨<span id="checkoutTotal">0.00</span>
                    </div>
                </div>

                <h3 style="font-family:'Rajdhani';color:#FFD300;margin:1.5rem 0 1rem;">M√©todo de Pago</h3>
                <div class="payment-methods">
                    <button class="payment-btn btn-card" onclick="selectPaymentMethod('card')">
                        <i class="fas fa-credit-card"></i>
                        <span>Tarjeta de Cr√©dito</span>
                    </button>
                    <button class="payment-btn btn-paypal" onclick="selectPaymentMethod('paypal')">
                        <i class="fab fa-paypal"></i>
                        <span>PayPal</span>
                    </button>
                    <button class="payment-btn btn-cash" onclick="selectPaymentMethod('cash')">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Efectivo</span>
                    </button>
                </div>

                <button class="btn-neo btn-success" onclick="processCheckout()" id="checkoutBtn">
                    <i class="fas fa-lock"></i> Pagar Ahora
                </button>
                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;" onclick="showView('cartView')">
                    ‚Üê Volver al Carrito
                </button>
            </div>
        </div>

        <!-- Mi GastroPass -->
        <div id="rewardsView" class="view">
            <div class="app-header">
                <h1>ü™ô Mi GastroPass</h1>
            </div>
            <div class="app-content">
                <div class="gastropass-card" style="text-align:center;background:linear-gradient(135deg,#2A1018,#3A1525);border:1px solid #FF2A6D;border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;">
                    <div class="level-badge" style="font-family:'Orbitron';font-size:1.3rem;color:#FFD300;margin-bottom:0.5rem;">ü•â Bronce</div>
                    <div style="font-size:0.9rem;color:#D0B0C0;margin-bottom:0.8rem;">Progreso hacia Plata</div>
                    <div class="progress-bar" style="background:rgba(0,0,0,0.3);height:12px;border-radius:10px;overflow:hidden;margin:0 0.5rem;">
                        <div class="progress-fill" style="height:100%;background:linear-gradient(90deg,#FF2A6D,#FFD300);width:56%;"></div>
                    </div>
                    <div style="font-size:0.85rem;color:#F0D0E0;margin-top:0.5rem;">280 / 500 pts</div>
                </div>

                <div class="benefits-section" style="background:rgba(30,10,15,0.6);border-radius:12px;padding:1.2rem;margin-bottom:1.5rem;">
                    <h3 style="font-family:'Rajdhani';color:#FFD300;margin-bottom:1rem;">üéÅ Tus Beneficios</h3>
                    <div style="font-size:0.95rem;line-height:1.6;color:#FFD6E0;">
                        <div>‚Ä¢ Men√∫ digital exclusivo</div>
                        <div>‚Ä¢ Cumplea√±os gratis</div>
                        <div>‚Ä¢ Acceso a eventos del chef</div>
                    </div>
                </div>

                <div class="rewards-section">
                    <h3 style="font-family:'Rajdhani';color:#FFD300;margin-bottom:0.8rem;">üõí Canjear Recompensas</h3>
                    <div class="reward-item">
                        <div><strong>Caf√© Gourmet</strong><br><small>100 pts</small></div>
                        <button class="reward-btn" onclick="redeemReward(100, 'Caf√© Gourmet')">
                            <i class="fas fa-gift"></i>
                        </button>
                    </div>
                    <div class="reward-item">
                        <div><strong>Postre del Chef</strong><br><small>250 pts</small></div>
                        <button class="reward-btn" onclick="redeemReward(250, 'Postre del Chef')">
                            <i class="fas fa-gift"></i>
                        </button>
                    </div>
                    <div class="reward-item">
                        <div><strong>Copa de Vino</strong><br><small>300 pts</small></div>
                        <button class="reward-btn" onclick="redeemReward(300, 'Copa de Vino')">
                            <i class="fas fa-gift"></i>
                        </button>
                    </div>
                    <div class="reward-item">
                        <div><strong>Men√∫ Degustaci√≥n</strong><br><small>800 pts</small></div>
                        <button class="reward-btn" onclick="redeemReward(800, 'Men√∫ Degustaci√≥n')">
                            <i class="fas fa-gift"></i>
                        </button>
                    </div>
                    <div class="reward-item">
                        <div><strong>Cena con el Chef</strong><br><small>1500 pts</small></div>
                        <button class="reward-btn" onclick="redeemReward(1500, 'Cena con el Chef')">
                            <i class="fas fa-gift"></i>
                        </button>
                    </div>
                </div>

                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;margin-top:1.5rem;" onclick="showView('homeView')">‚Üê Volver</button>
            </div>
        </div>

        <!-- Panel Due√±o -->
        <div id="ownerDashboard" class="view">
            <div class="app-header">
                <h1>üîê Panel Quantum</h1>
            </div>
            <div class="app-content">
                <div class="summary-card" style="background:rgba(30,10,15,0.5);border:1px solid #FF2A6D;border-radius:12px;padding:1rem;margin-bottom:1.5rem;">
                    <div style="font-family:'Orbitron';color:#FFD300;font-size:1.1rem;margin-bottom:0.8rem;">üìä Resumen del D√≠a</div>
                    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:0.6rem;font-size:0.9rem;">
                        <div><strong>Ingresos:</strong> <span id="dailyRevenue">‚Ç¨0</span></div>
                        <div><strong>Mesas ocupadas:</strong> <span id="occupiedTables">0/12</span></div>
                        <div><strong>Pedidos pendientes:</strong> <span id="pendingOrders">0</span></div>
                        <div><strong>Clientes en espera:</strong> <span id="waitingClients">0</span></div>
                    </div>
                </div>

                <div id="alertsSection" class="alerts-section" style="background:rgba(255,42,109,0.1);border:1px solid #FF2A6D;border-radius:12px;padding:1rem;margin-bottom:1.5rem;display:none;">
                    <div style="font-family:'Orbitron';color:#FF2A6D;font-size:1.1rem;margin-bottom:0.8rem;">‚ö†Ô∏è Alertas</div>
                    <div id="alertsList" style="font-size:0.9rem;color:#FFD300;line-height:1.5;"></div>
                </div>

                <!-- Leaderboard Empleados -->
                <div class="leaderboard">
                    <div class="leaderboard-title">üèÜ Ranking Empleados</div>
                    <div id="ownerLeaderboard"></div>
                </div>

                <button class="btn-neo btn-verify" onclick="verifyAllOrders()">
                    ‚úÖ Verificar Todos los Pedidos
                </button>
                <button class="btn-neo" style="background:#e74c3c;color:white;" onclick="logoutOwner()">Cerrar Sesi√≥n</button>
            </div>
        </div>

        <!-- === Vistas de Camarero === -->
        <div id="waiterLoginView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-user-tie"></i> Camarero</h1>
            </div>
            <div class="app-content" style="text-align:center;">
                <div style="margin:2rem 0;">
                    <i class="fas fa-key" style="font-size:3rem;color:#FF2A6D;"></i>
                    <div style="margin-top:1rem;font-family:'Rajdhani';font-size:1.1rem;">Ingresa tu PIN</div>
                </div>
                <input type="password" id="waiterPin" class="form-control" placeholder="****" style="max-width:200px;margin:0 auto;">
                <button class="btn-neo btn-primary" onclick="loginWaiter()" style="margin-top:1.5rem;">
                    Ingresar
                </button>
                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;margin-top:1rem;" onclick="showView('homeView')">
                    ‚Üê Volver
                </button>
            </div>
        </div>

        <div id="waiterTablesView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-concierge-bell"></i> Mesas</h1>
            </div>
            <div class="app-content">
                <!-- Leaderboard Empleados -->
                <div class="leaderboard">
                    <div class="leaderboard-title">‚ö° Tu Posici√≥n</div>
                    <div id="waiterLeaderboard"></div>
                </div>

                <h3 style="font-family:'Rajdhani';color:#FFD300;margin:1.5rem 0 1rem;">Gesti√≥n de Mesas</h3>
                <div id="tablesGrid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 1rem;"></div>
                
                <!-- Actividad Reciente -->
                <div class="activity-feed" id="waiterActivityFeed"></div>

                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;margin-top:1.5rem;" onclick="logoutWaiter()">
                    ‚Üê Cerrar Sesi√≥n
                </button>
            </div>
        </div>

        <div id="waiterOrderView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-clipboard-list"></i> Mesa <span id="orderTableNum">1</span></h1>
            </div>
            <div class="app-content">
                <div class="form-group">
                    <label>Comensales</label>
                    <select id="guestsCount" class="form-control">
                        <option>1</option><option>2</option><option>3</option><option>4</option>
                    </select>
                </div>

                <div id="orderSummary" style="margin-top:1.5rem; background:rgba(30,10,15,0.6); padding:1rem; border-radius:12px; display:none;">
                    <h3 style="font-family:'Rajdhani';color:#FFD300;margin:0 0 0.8rem;">Pedido Actual</h3>
                    <div id="orderItemsList"></div>
                    <div style="font-family:'Orbitron';color:#FF2A6D;font-size:1.2rem;margin-top:0.8rem;">
                        Total: ‚Ç¨<span id="orderTotal">0.00</span>
                    </div>
                </div>

                <button class="btn-neo btn-primary" onclick="sendOrderToKitchen()" style="margin-top:1rem; display:none;" id="sendOrderBtn">
                    <i class="fas fa-fire"></i> Enviar a Cocina
                </button>
                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;" onclick="showView('waiterTablesView')">
                    ‚Üê Volver a Mesas
                </button>
            </div>
        </div>

        <div id="paymentView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-cash-register"></i> Cobrar Mesa <span id="paymentTableNum">1</span></h1>
            </div>
            <div class="app-content">
                <div style="background:rgba(30,10,15,0.6); padding:1rem; border-radius:12px; margin-bottom:1.5rem;">
                    <h3 style="font-family:'Rajdhani';color:#FFD300;margin:0 0 0.8rem;">Resumen</h3>
                    <div id="paymentOrderItems"></div>
                    <div style="font-family:'Orbitron';color:#FF2A6D;font-size:1.3rem;margin-top:0.8rem;">
                        Total: ‚Ç¨<span id="paymentTotal">0.00</span>
                    </div>
                </div>

                <div class="payment-methods">
                    <button class="payment-btn btn-cash" onclick="processPayment('cash')">
                        <i class="fas fa-money-bill-wave"></i> Efectivo
                    </button>
                    <button class="payment-btn btn-card" onclick="processPayment('card')">
                        <i class="fas fa-credit-card"></i> Tarjeta
                    </button>
                </div>

                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;" onclick="showView('waiterTablesView')">
                    ‚Üê Volver
                </button>
            </div>
        </div>
    </div>

    <!-- Navegaci√≥n inferior -->
    <div class="app-nav">
        <a href="#" class="nav-item active" onclick="showView('homeView'); return false;">
            <i class="fas fa-home"></i>
            <span>Inicio</span>
        </a>
        <a href="#" class="nav-item" onclick="showView('bookingView'); return false;">
            <i class="fas fa-calendar"></i>
            <span>Reservas</span>
        </a>
        <a href="#" class="nav-item" onclick="showView('menuView'); return false;">
            <i class="fas fa-book"></i>
            <span>Men√∫</span>
        </a>
        <a href="#" class="nav-item" onclick="showView('qrScannerView'); return false;">
            <i class="fas fa-qrcode"></i>
            <span>Escanear</span>
        </a>
        <a href="#" class="nav-item" onclick="showView('cartView'); return false;" id="cartNavItem">
            <i class="fas fa-shopping-cart"></i>
            <span>Carrito</span>
            <div class="cart-badge" id="cartBadge" style="display: none;">0</div>
        </a>
    </div>

    <!-- Bot√≥n Descarga App -->
    <button class="download-btn" onclick="installApp()">
        <i class="fas fa-download"></i>
    </button>

    <script>
        // === ESTADO GLOBAL MEJORADO ===
        let appState = {
            user: null,
            employee: null,
            cart: JSON.parse(localStorage.getItem('gastroneo_cart')) || [],
            currentOrder: null,
            currentPaymentOrder: null,
            selectedPaymentMethod: null,
            employees: [
                { id: 'emp_1', name: 'Carlos Rodr√≠guez', points: 850, level: 'diamante', todayPoints: 45 },
                { id: 'emp_2', name: 'Ana Mart√≠nez', points: 720, level: 'oro', todayPoints: 32 },
                { id: 'emp_3', name: 'Luis Garc√≠a', points: 450, level: 'plata', todayPoints: -12 },
                { id: 'emp_4', name: 'Mar√≠a L√≥pez', points: 380, level: 'bronce', todayPoints: 18 }
            ],
            activities: [],
            notifications: JSON.parse(localStorage.getItem('gastroneo_notifications')) || []
        };

        // === INICIALIZACI√ìN MEJORADA ===
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const splash = document.getElementById('splashScreen');
                if (splash) {
                    splash.style.display = 'none';
                }
                initializeApp();
            }, 2000);
        });

        function initializeApp() {
            console.log('üöÄ Inicializando GastroNeo Quantum...');
            
            // Inicializar sistemas
            loadUser();
            renderAuthOrProfile();
            renderTablesGrid();
            updateCartBadge();
            checkMesaEscaneada();
            
            // Inicializar sistemas inteligentes
            initializeNotificationSystem();
            initializeGamificationSystem();
            startLiveActivities();
            
            // Mostrar notificaci√≥n de bienvenida
            setTimeout(() => {
                createNotification('success', '¬°Bienvenido!', 'Sistema GastroNeo Quantum iniciado');
            }, 500);
        }

        // === SISTEMA DE VISTAS CORREGIDO ===
        function showView(viewId) {
            console.log('üîÄ Cambiando a vista:', viewId);
            
            // Ocultar todas las vistas
            document.querySelectorAll('.view').forEach(v => {
                v.classList.remove('active');
            });
            
            // Mostrar vista objetivo
            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.classList.add('active');
            } else {
                console.error('‚ùå Vista no encontrada:', viewId);
                return;
            }
            
            // Actualizar navegaci√≥n
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            
            const viewToNavMap = {
                'homeView': 0, 
                'bookingView': 1, 
                'menuView': 2, 
                'qrScannerView': 3, 
                'cartView': 4
            };
            
            if (viewToNavMap[viewId] !== undefined) {
                const navItems = document.querySelectorAll('.nav-item');
                if (navItems[viewToNavMap[viewId]]) {
                    navItems[viewToNavMap[viewId]].classList.add('active');
                }
            }
            
            // Ejecutar acciones espec√≠ficas de vista
            switch(viewId) {
                case 'ownerDashboard':
                    loadOwnerDashboard();
                    break;
                case 'cartView':
                    renderCart();
                    break;
                case 'checkoutView':
                    renderCheckout();
                    break;
                case 'menuView':
                    checkMesaEscaneada();
                    break;
                case 'waiterTablesView':
                    renderWaiterDashboard();
                    break;
            }
        }

        // === SISTEMA DE NOTIFICACIONES INTELIGENTES ===
        function initializeNotificationSystem() {
            // Cargar notificaciones existentes
            renderNotifications();
            
            // Simular nuevas notificaciones
            setInterval(() => {
                if (Math.random() > 0.7) { // 30% probabilidad
                    simulateIntelligentNotification();
                }
            }, 30000);
        }

        function createNotification(type, title, message, actions = []) {
            const notification = {
                id: 'notif_' + Date.now(),
                type: type,
                title: title,
                message: message,
                timestamp: new Date().toISOString(),
                read: false,
                actions: actions
            };
            
            appState.notifications.unshift(notification);
            localStorage.setItem('gastroneo_notifications', JSON.stringify(appState.notifications));
            
            renderNotification(notification);
            playNotificationSound(type);
        }

        function renderNotifications() {
            const container = document.getElementById('notificationContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Mostrar √∫ltimas 3 notificaciones no le√≠das
            const unreadNotifications = appState.notifications
                .filter(n => !n.read)
                .slice(0, 3);
            
            unreadNotifications.forEach(notification => {
                renderNotification(notification);
            });
        }

        function renderNotification(notification) {
            const container = document.getElementById('notificationContainer');
            const notificationEl = document.createElement('div');
            notificationEl.className = `notification ${notification.type}`;
            notificationEl.innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <div style="font-family: 'Orbitron'; font-weight: 700; font-size: 0.9rem;">${notification.title}</div>
                    <div style="font-size: 0.7rem; color: #D0B0C0;">Ahora</div>
                </div>
                <div style="font-size: 0.85rem; line-height: 1.3;">${notification.message}</div>
                ${notification.actions.length > 0 ? `
                    <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem;">
                        ${notification.actions.map(action => `
                            <button style="padding: 0.3rem 0.8rem; border: none; border-radius: 6px; font-size: 0.8rem; cursor: pointer; background: ${getActionColor(action.type)}; color: white;" 
                                    onclick="${action.handler}">
                                ${action.label}
                            </button>
                        `).join('')}
                    </div>
                ` : ''}
            `;
            
            container.appendChild(notificationEl);
            
            // Auto-remover despu√©s de 8 segundos
            setTimeout(() => {
                if (notificationEl.parentNode) {
                    notificationEl.style.animation = 'slideInRight 0.3s ease reverse';
                    setTimeout(() => {
                        if (notificationEl.parentNode) {
                            notificationEl.remove();
                        }
                    }, 300);
                }
            }, 8000);
        }

        function getActionColor(type) {
            const colors = {
                'resolve': '#00F0FF',
                'escalate': '#FF2A6D', 
                'ignore': '#6E00FF'
            };
            return colors[type] || '#FF2A6D';
        }

        function playNotificationSound(type) {
            // En implementaci√≥n real, aqu√≠ cargar√≠as sonidos
            console.log(`üîä Reproduciendo sonido para: ${type}`);
        }

        function simulateIntelligentNotification() {
            const notifications = [
                {
                    type: 'warning',
                    title: '‚è∞ ALERTA TIEMPO',
                    message: 'Mesa 8 - 15min esperando pedido\nResponsable: Carlos\nüìç Terraza derecha',
                    actions: [
                        { type: 'resolve', label: 'Resolver', handler: "resolveNotification('temp_alert')" },
                        { type: 'escalate', label: 'Escalar', handler: "escalateNotification('temp_alert')" }
                    ]
                },
                {
                    type: 'success',
                    title: '‚≠ê CLIENTE FELIZ',
                    message: 'Ana recibi√≥ elogios de Mesa 3\n+15 puntos autom√°ticos',
                    actions: [
                        { type: 'resolve', label: 'OK', handler: "resolveNotification('praise_alert')" }
                    ]
                },
                {
                    type: 'danger', 
                    title: 'üö® ATENCI√ìN URGENTE',
                    message: 'Mesa 12 - 2do pedido incorrecto\nLuis -25 puntos',
                    actions: [
                        { type: 'escalate', label: 'Supervisor', handler: "escalateNotification('error_alert')" },
                        { type: 'ignore', label: 'Ignorar', handler: "ignoreNotification('error_alert')" }
                    ]
                }
            ];
            
            const randomNotif = notifications[Math.floor(Math.random() * notifications.length)];
            createNotification(randomNotif.type, randomNotif.title, randomNotif.message, randomNotif.actions);
        }

        // === SISTEMA DE GAMIFICACI√ìN LABORAL ===
        function initializeGamificationSystem() {
            renderEmployeeLeaderboards();
            
            // Simular actualizaciones de puntos
            setInterval(() => {
                updateRandomEmployeePoints();
            }, 45000);
        }

        function updateRandomEmployeePoints() {
            const employees = appState.employees;
            const randomEmp = employees[Math.floor(Math.random() * employees.length)];
            const pointsChange = Math.random() > 0.3 ? 
                Math.floor(Math.random() * 15) + 5 : 
                -Math.floor(Math.random() * 10) - 5;
            
            randomEmp.points += pointsChange;
            randomEmp.todayPoints += pointsChange;
            
            // Actualizar nivel
            updateEmployeeLevel(randomEmp);
            
            // Guardar y renderizar
            localStorage.setItem('gastroneo_employees', JSON.stringify(employees));
            renderEmployeeLeaderboards();
            
            // Agregar actividad
            const activityType = pointsChange > 0 ? 'positive' : 'negative';
            addActivity(activityType, `${randomEmp.name} ${pointsChange > 0 ? '+' : ''}${pointsChange} puntos`);
        }

        function updateEmployeeLevel(employee) {
            const levels = {
                novato: { min: 0, max: 100 },
                bronce: { min: 101, max: 300 },
                plata: { min: 301, max: 600 },
                oro: { min: 601, max: 1000 },
                diamante: { min: 1001, max: Infinity }
            };
            
            for (const [level, range] of Object.entries(levels)) {
                if (employee.points >= range.min && employee.points <= range.max) {
                    employee.level = level;
                    break;
                }
            }
        }

        function renderEmployeeLeaderboards() {
            renderOwnerLeaderboard();
            renderWaiterLeaderboard();
        }

        function renderOwnerLeaderboard() {
            const container = document.getElementById('ownerLeaderboard');
            if (!container) return;

            const sortedEmployees = [...appState.employees].sort((a, b) => b.points - a.points);
            
            container.innerHTML = sortedEmployees.map((emp, index) => {
                const rankClass = index === 0 ? 'rank-diamante' : 
                                index === 1 ? 'rank-oro' : 
                                index === 2 ? 'rank-plata' : 'rank-bronce';
                
                return `
                    <div class="leaderboard-item">
                        <div class="rank-badge ${rankClass}">${emp.points}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">${emp.name}</div>
                            <div style="font-size: 0.8rem; color: #D0B0C0;">
                                ${emp.level.toUpperCase()} 
                                ‚Ä¢ Hoy: 
                                <span style="color: ${emp.todayPoints > 0 ? '#00FF00' : '#FF4444'};">
                                    ${emp.todayPoints > 0 ? '+' : ''}${emp.todayPoints}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderWaiterLeaderboard() {
            const container = document.getElementById('waiterLeaderboard');
            if (!container) return;

            const sortedEmployees = [...appState.employees].sort((a, b) => b.points - a.points);
            
            container.innerHTML = sortedEmployees.slice(0, 3).map((emp, index) => {
                const rankClass = index === 0 ? 'rank-diamante' : 
                                index === 1 ? 'rank-oro' : 
                                'rank-plata';
                
                return `
                    <div class="leaderboard-item">
                        <div class="rank-badge ${rankClass}">${index + 1}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #FFD300;">${emp.name}</div>
                            <div style="font-size: 0.8rem; color: #D0B0C0;">
                                ${emp.points} pts
                                ${emp.todayPoints !== 0 ? 
                                    `<span style="color: ${emp.todayPoints > 0 ? '#00FF00' : '#FF4444'};">
                                        ${emp.todayPoints > 0 ? '+' : ''}${emp.todayPoints}
                                    </span>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // === ACTIVIDAD EN VIVO ===
        function startLiveActivities() {
            // Actividades iniciales
            addActivity('positive', 'Sistema GastroNeo Quantum iniciado');
            addActivity('neutral', 'Todos los sistemas operativos');
            
            // Simular actividad peri√≥dica
            setInterval(() => {
                simulateLiveActivity();
            }, 20000);
        }

        function addActivity(type, message) {
            const activity = {
                id: 'act_' + Date.now(),
                type: type,
                message: message,
                timestamp: new Date().toLocaleTimeString('es-ES', { 
                    hour: '2-digit', 
                    minute: '2-digit'
                })
            };
            
            appState.activities.unshift(activity);
            appState.activities = appState.activities.slice(0, 6);
            renderActivityFeeds();
        }

        function renderActivityFeeds() {
            renderHomeActivityFeed();
            renderWaiterActivityFeed();
        }

        function renderHomeActivityFeed() {
            const feed = document.getElementById('liveActivityFeed');
            if (!feed) return;
            
            feed.innerHTML = appState.activities.map(activity => `
                <div class="activity-item activity-${activity.type}">
                    <div>${activity.message}</div>
                    <div style="font-size: 0.7rem; color: #D0B0C0; margin-top: 0.2rem;">
                        ${activity.timestamp}
                    </div>
                </div>
            `).join('');
        }

        function renderWaiterActivityFeed() {
            const feed = document.getElementById('waiterActivityFeed');
            if (!feed) return;
            
            // Filtrar actividades relevantes para empleados
            const employeeActivities = appState.activities.filter(act => 
                act.message.includes('puntos') || 
                act.message.includes('pedido') ||
                act.message.includes('Mesa')
            );
            
            feed.innerHTML = employeeActivities.map(activity => `
                <div class="activity-item activity-${activity.type}">
                    <div>${activity.message}</div>
                    <div style="font-size: 0.7rem; color: #D0B0C0; margin-top: 0.2rem;">
                        ${activity.timestamp}
                    </div>
                </div>
            `).join('');
        }

        function simulateLiveActivity() {
            const activities = [
                'positive: Carlos +10pts: Cliente elogi√≥ servicio en Mesa 3',
                'positive: Ana +8pts: Upselling exitoso en Mesa 7',
                'negative: Luis -12pts: Tiempo excedido en pedido Mesa 5',
                'positive: Sistema: Nuevo pedido completado - Mesa 8',
                'neutral: Inventario: Stock bajo en ingrediente premium',
                'positive: Mar√≠a +15pts: Cliente frecuente
                                'positive: Cliente recomienda restaurante en redes'
            ];
            
            const randomActivity = activities[Math.floor(Math.random() * activities.length)];
            const [type, message] = randomActivity.split(': ');
            addActivity(type, message);
        }

        // === SISTEMA DE USUARIO Y AUTENTICACI√ìN ===
        function loadUser() {
            const savedUser = localStorage.getItem('gastroneo_user');
            if (savedUser) {
                appState.user = JSON.parse(savedUser);
            }
        }

        function renderAuthOrProfile() {
            const container = document.getElementById('authOrProfile');
            if (!container) return;

            if (appState.user) {
                container.innerHTML = `
                    <div style="background: rgba(255,42,109,0.1); border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-family: 'Orbitron'; color: #FFD300; font-size: 1rem;">¬°Hola, ${appState.user.name}!</div>
                                <div style="font-size: 0.8rem; color: #D0B0C0;">Nivel: ${appState.user.level || 'Bronce'}</div>
                            </div>
                            <button class="menu-card-btn" onclick="logoutUser()" style="background: #FF2A6D;">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div style="background: rgba(0,240,255,0.1); border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem;">
                        <div style="text-align: center;">
                            <div style="font-family: 'Orbitron'; color: #00F0FF; margin-bottom: 0.5rem;">¬øEres Nuevo?</div>
                            <button class="btn-neo btn-verify" onclick="showAuthModal()" style="padding: 0.6rem 1rem; font-size: 0.9rem;">
                                <i class="fas fa-user-plus"></i> Registrarse
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function showAuthModal() {
            // En una implementaci√≥n real, mostrar√≠as un modal de registro
            const name = prompt("Nombre completo:");
            const email = prompt("Email:");
            const phone = prompt("Tel√©fono:");
            
            if (name && email) {
                appState.user = {
                    id: 'user_' + Date.now(),
                    name: name,
                    email: email,
                    phone: phone,
                    level: 'Bronce',
                    points: 0,
                    joinDate: new Date().toISOString()
                };
                
                localStorage.setItem('gastroneo_user', JSON.stringify(appState.user));
                renderAuthOrProfile();
                createNotification('success', '¬°Bienvenido!', `Cuenta creada para ${name}`);
            }
        }

        function logoutUser() {
            appState.user = null;
            localStorage.removeItem('gastroneo_user');
            renderAuthOrProfile();
            createNotification('info', 'Sesi√≥n cerrada', 'Has cerrado sesi√≥n correctamente');
        }

        // === SISTEMA DE CARRITO MEJORADO ===
        function addToCart(itemName, price, image) {
            const existingItem = appState.cart.find(item => item.name === itemName);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                appState.cart.push({
                    id: 'item_' + Date.now(),
                    name: itemName,
                    price: price,
                    image: image,
                    quantity: 1,
                    addedAt: new Date().toISOString()
                });
            }
            
            saveCart();
            updateCartBadge();
            createNotification('success', '‚úÖ A√±adido', `${itemName} agregado al carrito`);
            
            // Vibrar si est√° disponible
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }
        }

        function removeFromCart(itemId) {
            appState.cart = appState.cart.filter(item => item.id !== itemId);
            saveCart();
            updateCartBadge();
            renderCart();
        }

        function updateQuantity(itemId, change) {
            const item = appState.cart.find(item => item.id === itemId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(itemId);
                    return;
                }
                saveCart();
                renderCart();
            }
        }

        function saveCart() {
            localStorage.setItem('gastroneo_cart', JSON.stringify(appState.cart));
        }

        function updateCartBadge() {
            const badge = document.getElementById('cartBadge');
            const totalItems = appState.cart.reduce((sum, item) => sum + item.quantity, 0);
            
            if (badge) {
                if (totalItems > 0) {
                    badge.textContent = totalItems;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        function renderCart() {
            const container = document.getElementById('cartItemsContainer');
            const emptyState = document.getElementById('emptyCart');
            const summary = document.getElementById('cartSummary');
            const totalAmount = document.getElementById('cartTotalAmount');
            
            if (!container) return;

            if (appState.cart.length === 0) {
                emptyState.style.display = 'block';
                summary.style.display = 'none';
                container.innerHTML = '';
                return;
            }

            emptyState.style.display = 'none';
            summary.style.display = 'block';

            let total = 0;
            container.innerHTML = appState.cart.map(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                return `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">‚Ç¨${item.price.toFixed(2)} x ${item.quantity}</div>
                        </div>
                        <div class="cart-item-controls">
                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', -1)">-</button>
                            <span style="margin: 0 0.5rem; font-weight: 600;">${item.quantity}</span>
                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', 1)">+</button>
                            <button class="quantity-btn" onclick="removeFromCart('${item.id}')" style="background: #FF2A6D; margin-left: 0.5rem;">
                                <i class="fas fa-trash" style="font-size: 0.7rem;"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            if (totalAmount) {
                totalAmount.textContent = `‚Ç¨${total.toFixed(2)}`;
            }
        }

        // === SISTEMA DE RESERVAS ===
        function confirmBooking() {
            const name = document.getElementById('clientName').value;
            const phone = document.getElementById('clientPhone').value;
            const date = document.getElementById('bookingDate').value;
            const time = document.getElementById('bookingTime').value;
            const guests = document.getElementById('guests').value;

            if (!name || !phone || !date || !time) {
                createNotification('danger', 'Datos incompletos', 'Por favor completa todos los campos');
                return;
            }

            const booking = {
                id: 'book_' + Date.now(),
                name: name,
                phone: phone,
                date: date,
                time: time,
                guests: guests,
                status: 'confirmed',
                createdAt: new Date().toISOString()
            };

            // Guardar reserva
            const bookings = JSON.parse(localStorage.getItem('gastroneo_bookings')) || [];
            bookings.push(booking);
            localStorage.setItem('gastroneo_bookings', JSON.stringify(bookings));

            // Mostrar confirmaci√≥n
            createNotification('success', '‚úÖ Reserva Confirmada', 
                `Mesa para ${guests} personas el ${date} a las ${time}`);

            // Limpiar formulario
            document.getElementById('clientName').value = '';
            document.getElementById('clientPhone').value = '';
            
            showView('homeView');
        }

        // === SISTEMA DE ESCANEO QR MEJORADO ===
        function simulateQRScan() {
            const mesaNumber = Math.floor(Math.random() * 12) + 1;
            setCurrentMesa(mesaNumber);
            
            createNotification('success', 'üì± QR Escaneado', 
                `Mesa ${mesaNumber} detectada. ¬°Bienvenido!`);
                
            showView('menuView');
        }

        function setCurrentMesa(mesaNumber) {
            localStorage.setItem('current_mesa', mesaNumber);
            checkMesaEscaneada();
        }

        function checkMesaEscaneada() {
            const mesaNumber = localStorage.getItem('current_mesa');
            const mesaInfo = document.getElementById('mesaInfo');
            const currentMesaSpan = document.getElementById('currentMesa');
            const mesaInfoCart = document.getElementById('mesaInfoCart');
            const currentMesaCart = document.getElementById('currentMesaCart');

            if (mesaNumber && mesaInfo && currentMesaSpan) {
                mesaInfo.style.display = 'block';
                currentMesaSpan.textContent = mesaNumber;
            }

            if (mesaNumber && mesaInfoCart && currentMesaCart) {
                mesaInfoCart.style.display = 'block';
                currentMesaCart.textContent = mesaNumber;
            }
        }

        // === SISTEMA DE PAGOS ===
        function selectPaymentMethod(method) {
            appState.selectedPaymentMethod = method;
            document.querySelectorAll('.payment-btn').forEach(btn => {
                btn.style.opacity = '0.7';
            });
            
            const selectedBtn = document.querySelector(`.btn-${method}`);
            if (selectedBtn) {
                selectedBtn.style.opacity = '1';
                selectedBtn.style.transform = 'scale(1.02)';
            }
        }

        function renderCheckout() {
            const orderItems = document.getElementById('checkoutOrderItems');
            const checkoutTotal = document.getElementById('checkoutTotal');
            
            if (!orderItems) return;

            let total = 0;
            orderItems.innerHTML = appState.cart.map(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                return `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.9rem;">
                        <span>${item.name} x${item.quantity}</span>
                        <span>‚Ç¨${itemTotal.toFixed(2)}</span>
                    </div>
                `;
            }).join('');

            if (checkoutTotal) {
                checkoutTotal.textContent = total.toFixed(2);
            }

            // Rellenar datos del usuario si existe
            if (appState.user) {
                const nameInput = document.getElementById('checkoutName');
                const emailInput = document.getElementById('checkoutEmail');
                const phoneInput = document.getElementById('checkoutPhone');
                
                if (nameInput) nameInput.value = appState.user.name || '';
                if (emailInput) emailInput.value = appState.user.email || '';
                if (phoneInput) phoneInput.value = appState.user.phone || '';
            }
        }

        function processCheckout() {
            if (!appState.selectedPaymentMethod) {
                createNotification('danger', 'M√©todo requerido', 'Selecciona un m√©todo de pago');
                return;
            }

            const name = document.getElementById('checkoutName').value;
            const email = document.getElementById('checkoutEmail').value;
            const phone = document.getElementById('checkoutPhone').value;

            if (!name || !email) {
                createNotification('danger', 'Datos incompletos', 'Completa nombre y email');
                return;
            }

            // Simular procesamiento de pago
            const checkoutBtn = document.getElementById('checkoutBtn');
            checkoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
            checkoutBtn.disabled = true;

            setTimeout(() => {
                // Crear orden
                const order = {
                    id: 'order_' + Date.now(),
                    items: [...appState.cart],
                    total: appState.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                    paymentMethod: appState.selectedPaymentMethod,
                    customer: { name, email, phone },
                    status: 'completed',
                    mesa: localStorage.getItem('current_mesa'),
                    createdAt: new Date().toISOString()
                };

                // Guardar orden
                const orders = JSON.parse(localStorage.getItem('gastroneo_orders')) || [];
                orders.push(order);
                localStorage.setItem('gastroneo_orders', JSON.stringify(orders));

                // Limpiar carrito
                appState.cart = [];
                saveCart();
                updateCartBadge();

                // Mostrar confirmaci√≥n
                createNotification('success', '‚úÖ Pago Exitoso', 
                    `Pedido #${order.id} completado. Total: ‚Ç¨${order.total.toFixed(2)}`);

                // Redirigir a home
                showView('homeView');
            }, 2000);
        }

        // === SISTEMA GASTROPASS (RECOMPENSAS) ===
        function redeemReward(pointsCost, rewardName) {
            if (!appState.user) {
                createNotification('danger', 'Inicia sesi√≥n', 'Necesitas una cuenta para canjear recompensas');
                return;
            }

            if ((appState.user.points || 0) < pointsCost) {
                createNotification('danger', 'Puntos insuficientes', 
                    `Necesitas ${pointsCost} puntos. Tienes: ${appState.user.points || 0}`);
                return;
            }

            if (confirm(`¬øCanjear ${rewardName} por ${pointsCost} puntos?`)) {
                appState.user.points -= pointsCost;
                localStorage.setItem('gastroneo_user', JSON.stringify(appState.user));
                
                createNotification('success', 'üéÅ Recompensa Canjeada', 
                    `¬°Disfruta tu ${rewardName}! Puntos restantes: ${appState.user.points}`);
                
                renderAuthOrProfile();
            }
        }

        // === SISTEMA PROPIETARIO/DUE√ëO ===
        function openOwnerAccess() {
            const password = prompt('üîê Contrase√±a de acceso due√±o:');
            // En producci√≥n, esto deber√≠a ser seguro
            if (password === 'quantum2024') {
                showView('ownerDashboard');
            } else {
                createNotification('danger', 'Acceso denegado', 'Contrase√±a incorrecta');
            }
        }

        function loadOwnerDashboard() {
            updateOwnerStats();
            loadAlerts();
        }

        function updateOwnerStats() {
            // Simular datos del d√≠a
            document.getElementById('dailyRevenue').textContent = '‚Ç¨' + (Math.random() * 2000 + 500).toFixed(0);
            document.getElementById('occupiedTables').textContent = Math.floor(Math.random() * 8 + 4) + '/12';
            document.getElementById('pendingOrders').textContent = Math.floor(Math.random() * 5);
            document.getElementById('waitingClients').textContent = Math.floor(Math.random() * 3);
        }

        function loadAlerts() {
            const alerts = [
                'Stock bajo: Vino tinto reserva',
                'Mesa 8 - 25min esperando pedido',
                'Cliente solicita manager en Mesa 3',
                'Sistema: Actualizaci√≥n requerida'
            ];

            const alertsList = document.getElementById('alertsList');
            const alertsSection = document.getElementById('alertsSection');

            if (alerts.length > 0) {
                alertsSection.style.display = 'block';
                alertsList.innerHTML = alerts.map(alert => 
                    `<div style="margin-bottom: 0.5rem;">‚Ä¢ ${alert}</div>`
                ).join('');
            }
        }

        function verifyAllOrders() {
            createNotification('success', 'Sistema verificado', 'Todos los pedidos confirmados y en proceso');
        }

        function logoutOwner() {
            showView('homeView');
            createNotification('info', 'Sesi√≥n cerrada', 'Panel due√±o cerrado');
        }

        // === SISTEMA CAMARERO ===
        function loginWaiter() {
            const pinInput = document.getElementById('waiterPin');
            const pin = pinInput.value;

            // PINs de ejemplo (en producci√≥n usar autenticaci√≥n segura)
            const employees = {
                '1234': { id: 'emp_1', name: 'Carlos Rodr√≠guez' },
                '5678': { id: 'emp_2', name: 'Ana Mart√≠nez' },
                '9012': { id: 'emp_3', name: 'Luis Garc√≠a' },
                '3456': { id: 'emp_4', name: 'Mar√≠a L√≥pez' }
            };

            if (employees[pin]) {
                appState.employee = employees[pin];
                createNotification('success', 'Acceso concedido', `Bienvenido ${appState.employee.name}`);
                showView('waiterTablesView');
                pinInput.value = '';
            } else {
                createNotification('danger', 'PIN incorrecto', 'Verifica tu c√≥digo de acceso');
            }
        }

        function renderWaiterDashboard() {
            renderTablesGrid();
        }

        function renderTablesGrid() {
            const grid = document.getElementById('tablesGrid');
            if (!grid) return;

            const tables = [];
            for (let i = 1; i <= 12; i++) {
                const occupied = Math.random() > 0.4;
                const needsAttention = occupied && Math.random() > 0.7;
                
                tables.push(`
                    <div class="table-card ${occupied ? 'occupied' : 'free'}" 
                         onclick="openTable(${i}, ${occupied})">
                        <div class="table-number">${i}</div>
                        <div class="table-status">${occupied ? 'OCUPADA' : 'LIBRE'}</div>
                        ${needsAttention ? '<div class="table-badge">!</div>' : ''}
                    </div>
                `);
            }

            grid.innerHTML = tables.join('');
        }

        function openTable(tableNumber, isOccupied) {
            if (!isOccupied) {
                // Mesa libre - tomar pedido
                appState.currentOrder = {
                    table: tableNumber,
                    items: [],
                    status: 'ordering'
                };
                document.getElementById('orderTableNum').textContent = tableNumber;
                showView('waiterOrderView');
            } else {
                // Mesa ocupada - cobrar o ver pedido
                appState.currentPaymentOrder = {
                    table: tableNumber,
                    items: [
                        { name: 'Men√∫ del d√≠a', price: 15.90, quantity: 2 },
                        { name: 'Agua mineral', price: 2.50, quantity: 1 },
                        { name: 'Caf√©', price: 2.00, quantity: 2 }
                    ],
                    total: 38.30
                };
                document.getElementById('paymentTableNum').textContent = tableNumber;
                showPaymentView();
            }
        }

        function showPaymentView() {
            const itemsContainer = document.getElementById('paymentOrderItems');
            const totalSpan = document.getElementById('paymentTotal');
            
            if (itemsContainer && totalSpan && appState.currentPaymentOrder) {
                itemsContainer.innerHTML = appState.currentPaymentOrder.items.map(item => `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>${item.name} x${item.quantity}</span>
                        <span>‚Ç¨${(item.price * item.quantity).toFixed(2)}</span>
                    </div>
                `).join('');
                
                totalSpan.textContent = appState.currentPaymentOrder.total.toFixed(2);
            }
            
            showView('paymentView');
        }

        function processPayment(method) {
            createNotification('success', 'Pago procesado', `Mesa ${appState.currentPaymentOrder.table} pagada con ${method}`);
            
            // Actualizar puntos del empleado
            if (appState.employee) {
                const emp = appState.employees.find(e => e.id === appState.employee.id);
                if (emp) {
                    emp.points += 10;
                    emp.todayPoints += 10;
                    updateEmployeeLevel(emp);
                    renderEmployeeLeaderboards();
                    addActivity('positive', `${emp.name} +10pts: Cobro exitoso Mesa ${appState.currentPaymentOrder.table}`);
                }
            }
            
            showView('waiterTablesView');
        }

        function logoutWaiter() {
            appState.employee = null;
            showView('homeView');
            createNotification('info', 'Sesi√≥n cerrada', 'Modo camarero finalizado');
        }

        // === PWA INSTALLATION ===
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        createNotification('success', 'App instalada', 'GastroNeo instalado correctamente');
                    }
                    deferredPrompt = null;
                });
            } else {
                createNotification('info', 'Instalaci√≥n', 'La app ya est√° instalada o no es compatible');
            }
        }

        // === SERVICE WORKER REGISTRATION ===
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // === UTILIDADES ADICIONALES ===
        function resolveNotification(notificationId) {
            createNotification('success', 'Alerta resuelta', 'Problema solucionado correctamente');
        }

        function escalateNotification(notificationId) {
            createNotification('warning', 'Alerta escalada', 'Supervisor notificado');
        }

        function ignoreNotification(notificationId) {
            createNotification('info', 'Alerta ignorada', 'Notificaci√≥n archivada');
        }

        // Manejo de errores global
        window.addEventListener('error', (e) => {
            console.error('Error global:', e.error);
            createNotification('danger', 'Error del sistema', 'Se produjo un error inesperado');
        });

        console.log('‚úÖ GastroNeo Quantum completamente inicializado');
    </script>
</body>
</html>
