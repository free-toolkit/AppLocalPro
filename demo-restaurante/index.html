<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="GastroNeo: Restaurante del Futuro con IA, Gamificación y Neo-Glassmorphism">
    <title>GastroNeo – Revolución Gastronómica</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* === VARIABLES NEO-GLASSMORPHISM === */
        :root {
            --neo-primary: #FF2A6D;
            --neo-secondary: #00F0FF;
            --neo-accent: #FFD300;
            --neo-purple: #6E00FF;
            --neo-bg: #0D0916;
            --neo-bg-light: #1A0A10;
            --neo-text: #FFD6E0;
            --neo-text-secondary: #D0B0C0;
        }

        /* === ESTILOS BASE === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: var(--neo-bg);
            color: var(--neo-text);
            overflow-x: hidden;
            font-family: 'Rajdhani', sans-serif;
            min-height: 100vh;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--neo-bg-light);
            position: relative;
            overflow: hidden;
        }

        /* === NEO-GLASSMORPHISM === */
        .neo-glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .neo-holographic {
            background: linear-gradient(125deg, 
                rgba(255, 42, 109, 0.1) 0%,
                rgba(0, 240, 255, 0.1) 50%,
                rgba(110, 0, 255, 0.1) 100%);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 240, 255, 0.3);
        }

        .neo-holographic::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.4), 
                transparent
            );
            animation: hologram-shine 3s infinite;
        }

        @keyframes hologram-shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* === HEADER HOLOGRÁFICO === */
        .app-header {
            background: linear-gradient(135deg, var(--neo-primary), var(--neo-accent));
            padding: 1.2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .app-header::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.6), 
                transparent
            );
            animation: header-shine 4s infinite;
        }

        @keyframes header-shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .app-header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            color: white;
            position: relative;
            z-index: 1;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            letter-spacing: 2px;
        }

        /* === CONTENIDO PRINCIPAL === */
        .app-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: rgba(34, 15, 24, 0.7);
        }

        .view { display: none; }
        .view.active { display: block; }

        /* === SPLASH SCREEN === */
        #splashScreen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--neo-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
            overflow: hidden;
        }

        .splash-logo {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--neo-primary), var(--neo-accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 0 50px rgba(255, 42, 109, 0.8);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .splash-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            color: var(--neo-secondary);
            text-shadow: 0 0 15px rgba(0, 240, 255, 0.8);
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === BOTONES NEO === */
        .btn-neo {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-family: 'Rajdhani', sans-serif;
            cursor: pointer;
            margin: 0.8rem 0;
            font-size: 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary { 
            background: linear-gradient(135deg, var(--neo-primary), #D10047); 
            color: white; 
        }

        .btn-secondary { 
            background: linear-gradient(135deg, var(--neo-secondary), #00B8FF); 
            color: var(--neo-bg); 
        }

        .btn-accent { 
            background: linear-gradient(135deg, var(--neo-accent), #FF9A00); 
            color: var(--neo-bg); 
        }

        .btn-purple { 
            background: linear-gradient(135deg, var(--neo-purple), #3A00B8); 
            color: white; 
        }

        /* === NAVEGACIÓN === */
        .app-nav {
            display: flex;
            justify-content: space-around;
            background: rgba(10, 7, 10, 0.9);
            border-top: 1px solid var(--neo-primary);
            padding: 0.8rem 0;
            backdrop-filter: blur(10px);
            flex-shrink: 0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--neo-text-secondary);
            text-decoration: none;
            font-size: 0.8rem;
            font-family: 'Rajdhani', sans-serif;
            transition: all 0.3s ease;
            position: relative;
            padding: 0.5rem;
        }

        .nav-item.active, .nav-item:hover {
            color: var(--neo-accent);
            transform: translateY(-2px);
        }

        .nav-item i { 
            font-size: 1.4rem; 
            margin-bottom: 0.3rem; 
        }

        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--neo-primary);
            color: white;
            font-size: 0.7rem;
            padding: 0.2rem 0.4rem;
            border-radius: 50%;
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* === NOTIFICACIONES === */
        .notification-container {
            position: fixed;
            top: 80px;
            right: 10px;
            z-index: 1000;
            max-width: 300px;
        }

        .notification {
            background: var(--neo-bg-light);
            border-left: 4px solid;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: slideInRight 0.3s ease;
        }

        .notification.warning { border-color: var(--neo-accent); }
        .notification.danger { border-color: var(--neo-primary); }
        .notification.success { border-color: var(--neo-secondary); }

        /* === GAMIFICACIÓN === */
        .leaderboard {
            background: rgba(20, 5, 10, 0.8);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            border: 1px solid var(--neo-primary);
        }

        .leaderboard-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: var(--neo-accent);
            text-align: center;
            margin-bottom: 1rem;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .rank-badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            margin-right: 1rem;
        }

        .rank-diamante { background: linear-gradient(135deg, #00FFFF, #0080FF); }
        .rank-oro { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .rank-plata { background: linear-gradient(135deg, #E5E4E2, #A8A8A8); }

        /* === MENÚ DIGITAL === */
        .menu-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .menu-card {
            background: rgba(25, 10, 15, 0.7);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 42, 109, 0.3);
            transition: all 0.3s ease;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 42, 109, 0.3);
        }

        .menu-card-img {
            height: 140px;
            overflow: hidden;
        }

        .menu-card-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .menu-card-body {
            padding: 1rem;
        }

        .menu-card-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            color: var(--neo-accent);
            margin-bottom: 0.5rem;
        }

        .menu-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .menu-card-price {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: var(--neo-primary);
            font-size: 1.1rem;
        }

        .menu-card-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--neo-primary), #D10047);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* === FORMULARIOS === */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            background: rgba(30, 10, 15, 0.6);
            color: var(--neo-text);
            border: 1px solid var(--neo-primary);
            border-radius: 8px;
            font-family: 'Rajdhani', sans-serif;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--neo-text-secondary);
        }

        /* === CARRITO === */
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            background: rgba(30, 10, 15, 0.6);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border: 1px solid rgba(255, 42, 109, 0.3);
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quantity-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--neo-primary);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .cart-total {
            background: linear-gradient(135deg, #2A1018, #3A1525);
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
            text-align: center;
            border: 1px solid var(--neo-primary);
        }

        /* === MESAS CAMAREROS === */
        .tables-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }

        .table-card {
            height: 80px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            border: 2px solid;
            transition: all 0.3s ease;
        }

        .table-free {
            background: rgba(40, 20, 30, 0.6);
            border-color: #333;
            color: #888;
        }

        .table-occupied {
            background: linear-gradient(135deg, #2A1018, #3A1525);
            border-color: var(--neo-primary);
            color: var(--neo-accent);
        }

        /* === ACTIVIDAD EN VIVO === */
        .activity-feed {
            max-height: 200px;
            overflow-y: auto;
            margin: 1rem 0;
        }

        .activity-item {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            font-size: 0.8rem;
            border-left: 3px solid;
        }

        .activity-positive { border-color: var(--neo-secondary); }
        .activity-negative { border-color: var(--neo-primary); }

        /* === NUEVOS ESTILOS PARA LAS FUNCIONALIDADES AÑADIDAS === */
        .progress-bar {
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neo-secondary), var(--neo-primary));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .timer-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: var(--neo-accent);
            text-align: center;
            margin: 1rem 0;
        }
        
        .complaint-form {
            background: rgba(30, 10, 15, 0.7);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            border: 1px solid rgba(255, 42, 109, 0.3);
        }
        
        .complaint-form textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .token-transfer {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .token-transfer input {
            flex: 1;
        }
        
        .token-transfer button {
            width: auto;
            padding: 0.8rem 1.2rem;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splashScreen">
        <div class="splash-logo">
            <i class="fas fa-utensils"></i>
        </div>
        <div class="splash-text">GASTRONEO QUANTUM</div>
    </div>

    <!-- Sistema de Notificaciones -->
    <div class="notification-container" id="notificationContainer"></div>

    <div class="app-container">
        <!-- ========== HOME VIEW ========== -->
        <div id="homeView" class="view active">
            <div class="app-header">
                <h1>GASTRONEO QUANTUM</h1>
            </div>
            <div class="app-content">
                <div id="authOrProfile"></div>

                <button class="btn-neo btn-primary" onclick="showView('bookingView')">
                    <i class="fas fa-calendar-plus"></i> Reservar Mesa
                </button>
                <button class="btn-neo btn-secondary" onclick="showView('qrScannerView')">
                    <i class="fas fa-qrcode"></i> Escanear Mesa
                </button>
                <button class="btn-neo btn-accent" onclick="showView('menuView')">
                    <i class="fas fa-book-open"></i> Menú Digital
                </button>
                <button class="btn-neo btn-purple" onclick="showView('rewardsView')">
                    <i class="fas fa-coins"></i> Mi GastroPass
                </button>
                
                <!-- NUEVO: Botón para tienda local -->
                <button class="btn-neo" style="background:linear-gradient(135deg, #6E00FF, #3A00B8); color:white;" onclick="showView('localStoreView')">
                    <i class="fas fa-store"></i> Tienda Local
                </button>

                <div class="neo-glass" style="padding: 1rem; margin: 1.5rem 0;">
                    <div style="font-family: 'Orbitron'; color: var(--neo-secondary); text-align: center; margin-bottom: 0.8rem;">
                        ACCESO EMPLEADOS
                    </div>
                    <button class="btn-neo" style="background: rgba(0,240,255,0.2); color: var(--neo-secondary); border: 1px solid var(--neo-secondary);" 
                            onclick="showView('employeeLoginView')">
                        <i class="fas fa-user-tie"></i> Panel Empleados
                    </button>
                    <button class="btn-neo" style="background: rgba(255,42,109,0.2); color: var(--neo-primary); border: 1px solid var(--neo-primary);" 
                            onclick="openOwnerAccess()">
                        <i class="fas fa-user-lock"></i> Panel Quantum
                    </button>
                </div>

                <div class="activity-feed" id="liveActivityFeed"></div>
            </div>
        </div>

        <!-- ========== RESERVAS ========== -->
        <div id="bookingView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-calendar-plus"></i> Reservar Mesa</h1>
            </div>
            <div class="app-content">
                <div class="form-group">
                    <label>Nombre Completo</label>
                    <input type="text" id="clientName" class="form-control" placeholder="Ej. Carlos Ruiz">
                </div>
                <div class="form-group">
                    <label>Teléfono</label>
                    <input type="tel" id="clientPhone" class="form-control" placeholder="+34 600 000 000">
                </div>
                <div class="form-group">
                    <label>Fecha</label>
                    <input type="date" id="bookingDate" class="form-control">
                </div>
                <div class="form-group">
                    <label>Hora</label>
                    <select id="bookingTime" class="form-control">
                        <option value="13:00">13:00</option>
                        <option value="13:30">13:30</option>
                        <option value="14:00">14:00</option>
                        <option value="20:00">20:00</option>
                        <option value="20:30">20:30</option>
                        <option value="21:00">21:00</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Comensales</label>
                    <select id="guests" class="form-control">
                        <option>1</option><option>2</option><option>3</option><option>4</option>
                    </select>
                </div>
                <button class="btn-neo btn-primary" onclick="confirmBooking()">Confirmar Reserva</button>
                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;" onclick="showView('homeView')">← Volver</button>
            </div>
        </div>

        <!-- ========== ESCANER QR ========== -->
        <div id="qrScannerView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-qrcode"></i> Escanear Mesa</h1>
            </div>
            <div class="app-content" style="text-align: center;">
                <div style="margin: 2rem 0;">
                    <i class="fas fa-qrcode" style="font-size: 4rem; color: var(--neo-secondary);"></i>
                    <div style="font-family: 'Rajdhani'; font-size: 1.1rem; color: var(--neo-accent); margin: 1rem 0;">
                        Escanea el código QR de tu mesa
                    </div>
                </div>
                
                <div class="neo-glass" style="padding: 2rem; margin: 1.5rem 0;">
                    <div class="scanner-icon">
                        <i class="fas fa-camera" style="font-size: 3rem; color: var(--neo-secondary);"></i>
                    </div>
                    <div style="color: var(--neo-text-secondary); margin: 1.5rem 0;">
                        Cámara lista para escanear...
                    </div>
                    <button class="btn-neo btn-secondary" onclick="simulateQRScan()">
                        <i class="fas fa-camera"></i> Simular Escaneo
                    </button>
                </div>

                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;" onclick="showView('homeView')">← Volver</button>
            </div>
        </div>

        <!-- ========== MENÚ DIGITAL ========== -->
        <div id="menuView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-book-open"></i> Menú Digital</h1>
            </div>
            <div class="app-content">
                <div id="mesaInfo" style="background: rgba(0, 240, 255, 0.1); border-radius: 8px; padding: 0.8rem; margin-bottom: 1rem; display: none;">
                    <div style="color: var(--neo-secondary); font-family: 'Orbitron'; font-size: 0.9rem;">
                        <i class="fas fa-table"></i> Mesa: <span id="currentMesa">-</span>
                    </div>
                </div>

                <div class="menu-category">
                    <h2 style="font-family: 'Orbitron'; color: var(--neo-primary); margin: 1.5rem 0 1rem; border-bottom: 2px solid var(--neo-primary); padding-bottom: 0.5rem;">ENTRADAS</h2>
                    <div class="menu-grid">
                        <div class="menu-card">
                            <div class="menu-card-img">
                                <img src="https://images.pexels.com/photos/3764643/pexels-photo-3764643.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Tartar de Atún">
                            </div>
                            <div class="menu-card-body">
                                <h3 class="menu-card-name">Tartar de Atún</h3>
                                <p style="color: var(--neo-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Atún fresco con wasabi y aguacate, marinado en salsa de soja</p>
                                <div class="menu-card-footer">
                                    <span class="menu-card-price">€16.50</span>
                                    <button class="menu-card-btn" onclick="addToCart('Tartar de Atún', 16.50)">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="menu-card">
                            <div class="menu-card-img">
                                <img src="https://images.pexels.com/photos/7049761/pexels-photo-7049761.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Bruschetta">
                            </div>
                            <div class="menu-card-body">
                                <h3 class="menu-card-name">Bruschetta</h3>
                                <p style="color: var(--neo-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Pan tostado artesanal con tomate fresco y albahaca</p>
                                <div class="menu-card-footer">
                                    <span class="menu-card-price">€9.90</span>
                                    <button class="menu-card-btn" onclick="addToCart('Bruschetta', 9.90)">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="menu-category">
                    <h2 style="font-family: 'Orbitron'; color: var(--neo-primary); margin: 1.5rem 0 1rem; border-bottom: 2px solid var(--neo-primary); padding-bottom: 0.5rem;">PLATOS FUERTES</h2>
                    <div class="menu-grid">
                        <div class="menu-card">
                            <div class="menu-card-img">
                                <img src="https://images.pexels.com/photos/1199381/pexels-photo-1199381.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Pasta Carbonara">
                            </div>
                            <div class="menu-card-body">
                                <h3 class="menu-card-name">Pasta Carbonara</h3>
                                <p style="color: var(--neo-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Pasta fresca con salsa cremosa de panceta y queso</p>
                                <div class="menu-card-footer">
                                    <span class="menu-card-price">€18.99</span>
                                    <button class="menu-card-btn" onclick="addToCart('Pasta Carbonara', 18.99)">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;margin-top:1.5rem;" onclick="showView('homeView')">← Volver</button>
            </div>
        </div>

        <!-- ========== TIENDA LOCAL ========== -->
        <div id="localStoreView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-store"></i> Tienda Local</h1>
            </div>
            <div class="app-content">
                <div class="neo-glass" style="padding: 1rem; margin-bottom: 1.5rem;">
                    <div style="font-family: 'Orbitron'; color: var(--neo-accent); text-align: center; margin-bottom: 0.8rem;">
                        PRODUCTOS ARTESANALES
                    </div>
                    <div style="color: var(--neo-text-secondary); text-align: center; font-size: 0.9rem;">
                        Descubre los sabores auténticos de nuestra región
                    </div>
                </div>

                <div class="menu-grid">
                    <!-- Miel Artesanal -->
                    <div class="menu-card">
                        <div class="menu-card-img">
                            <img src="https://images.pexels.com/photos/547263/pexels-photo-547263.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Miel Artesanal">
                        </div>
                        <div class="menu-card-body">
                            <h3 class="menu-card-name">Miel Artesanal</h3>
                            <p style="color: var(--neo-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Miel pura de abeja recolectada en los montes locales</p>
                            <div class="menu-card-footer">
                                <span class="menu-card-price">€12.90</span>
                                <button class="menu-card-btn" onclick="addToCart('Miel Artesanal', 12.90)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Queso de Cabra -->
                    <div class="menu-card">
                        <div class="menu-card-img">
                            <img src="https://images.pexels.com/photos/8213650/pexels-photo-8213650.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Queso de Cabra">
                        </div>
                        <div class="menu-card-body">
                            <h3 class="menu-card-name">Queso de Cabra</h3>
                            <p style="color: var(--neo-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Queso artesanal de cabra curado 6 meses</p>
                            <div class="menu-card-footer">
                                <span class="menu-card-price">€18.50</span>
                                <button class="menu-card-btn" onclick="addToCart('Queso de Cabra', 18.50)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Aceite de Oliva Virgen Extra -->
                    <div class="menu-card">
                        <div class="menu-card-img">
                            <img src="https://images.pexels.com/photos/33783/olive-oil-salad-dressing-healthy-eating.jpg?auto=compress&cs=tinysrgb&w=600" alt="Aceite de Oliva">
                        </div>
                        <div class="menu-card-body">
                            <h3 class="menu-card-name">Aceite de Oliva Virgen Extra</h3>
                            <p style="color: var(--neo-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Primera prensada en frío, botella 500ml</p>
                            <div class="menu-card-footer">
                                <span class="menu-card-price">€15.75</span>
                                <button class="menu-card-btn" onclick="addToCart('Aceite de Oliva Virgen Extra', 15.75)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Embutidos Caseros -->
                    <div class="menu-card">
                        <div class="menu-card-img">
                            <img src="https://images.pexels.com/photos/4109127/pexels-photo-4109127.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Embutidos Caseros">
                        </div>
                        <div class="menu-card-body">
                            <h3 class="menu-card-name">Embutidos Caseros</h3>
                            <p style="color: var(--neo-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Selección de chorizo, salchichón y lomo embuchado</p>
                            <div class="menu-card-footer">
                                <span class="menu-card-price">€22.90</span>
                                <button class="menu-card-btn" onclick="addToCart('Embutidos Caseros', 22.90)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Vino Tinto de la Tierra -->
                    <div class="menu-card">
                        <div class="menu-card-img">
                            <img src="https://images.pexels.com/photos/290316/pexels-photo-290316.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Vino Tinto">
                        </div>
                        <div class="menu-card-body">
                            <h3 class="menu-card-name">Vino Tinto de la Tierra</h3>
                            <p style="color: var(--neo-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Vino crianza 12 meses en barrica, botella 750ml</p>
                            <div class="menu-card-footer">
                                <span class="menu-card-price">€14.50</span>
                                <button class="menu-card-btn" onclick="addToCart('Vino Tinto de la Tierra', 14.50)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Mermelada de Frutos del Bosque -->
                    <div class="menu-card">
                        <div class="menu-card-img">
                            <img src="https://images.pexels.com/photos/4207791/pexels-photo-4207791.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Mermelada de Frutos del Bosque">
                        </div>
                        <div class="menu-card-body">
                            <h3 class="menu-card-name">Mermelada de Frutos del Bosque</h3>
                            <p style="color: var(--neo-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Elaborada artesanalmente con frutos silvestres</p>
                            <div class="menu-card-footer">
                                <span class="menu-card-price">€8.90</span>
                                <button class="menu-card-btn" onclick="addToCart('Mermelada de Frutos del Bosque', 8.90)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;margin-top:1.5rem;" onclick="showView('homeView')">← Volver</button>
            </div>
        </div>

        <!-- ========== CARRITO ========== -->
        <div id="cartView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-shopping-cart"></i> Mi Carrito</h1>
            </div>
            <div class="app-content">
                <div id="mesaInfoCart" style="background: rgba(0, 240, 255, 0.1); border-radius: 8px; padding: 0.8rem; margin-bottom: 1rem; display: none;">
                    <div style="color: var(--neo-secondary); font-family: 'Orbitron'; font-size: 0.9rem;">
                        <i class="fas fa-table"></i> Mesa: <span id="currentMesaCart">-</span>
                    </div>
                </div>

                <div id="cartItemsContainer"></div>
                
                <div id="emptyCart" class="empty-state" style="display: none; text-align: center; padding: 2rem; color: var(--neo-text-secondary);">
                    <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                    <h3>Tu carrito está vacío</h3>
                    <p>¡Añade algunos productos deliciosos!</p>
                </div>

                <div id="cartSummary" style="display: none;">
                    <div class="cart-total">
                        <div>Total del Pedido</div>
                        <div style="font-family: 'Orbitron'; font-size: 1.5rem; color: var(--neo-accent); margin: 0.5rem 0;" id="cartTotalAmount">€0.00</div>
                    </div>
                    
                    <button class="btn-neo btn-primary" onclick="showView('checkoutView')">
                        <i class="fas fa-credit-card"></i> Proceder al Pago
                    </button>
                </div>

                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;" onclick="showView('menuView')">← Seguir Comprando</button>
            </div>
        </div>

        <!-- ========== CHECKOUT ========== -->
        <div id="checkoutView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-credit-card"></i> Checkout</h1>
            </div>
            <div class="app-content">
                <div class="form-group">
                    <label>Nombre Completo</label>
                    <input type="text" id="checkoutName" class="form-control" placeholder="Como aparece en la tarjeta">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="checkoutEmail" class="form-control" placeholder="tu@email.com">
                </div>

                <div style="background:rgba(30,10,15,0.6); padding:1rem; border-radius:12px; margin:1.5rem 0;">
                    <h3 style="font-family:'Rajdhani';color:var(--neo-accent);margin:0 0 0.8rem;">Resumen del Pedido</h3>
                    <div id="checkoutOrderItems"></div>
                    <div style="font-family:'Orbitron';color:var(--neo-primary);font-size:1.3rem;margin-top:0.8rem;">
                        Total: €<span id="checkoutTotal">0.00</span>
                    </div>
                </div>

                <h3 style="font-family:'Rajdhani';color:var(--neo-accent);margin:1.5rem 0 1rem;">Método de Pago</h3>
                <div style="display: grid; gap: 0.8rem; margin: 1.5rem 0;">
                    <button class="btn-neo" style="background:linear-gradient(135deg, #6E00FF, #3A00B8); color:white;" onclick="selectPaymentMethod('card')">
                        <i class="fas fa-credit-card"></i> Tarjeta de Crédito
                    </button>
                    <button class="btn-neo" style="background:linear-gradient(135deg, #00F0FF, #00B8FF); color:var(--neo-bg);" onclick="selectPaymentMethod('cash')">
                        <i class="fas fa-money-bill-wave"></i> Efectivo
                    </button>
                </div>

                <button class="btn-neo btn-primary" onclick="processCheckout()">
                    <i class="fas fa-lock"></i> Pagar Ahora
                </button>
                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;" onclick="showView('cartView')">← Volver al Carrito</button>
            </div>
        </div>

        <!-- ========== GASTROPASS ========== -->
        <div id="rewardsView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-coins"></i> Mi GastroPass</h1>
            </div>
            <div class="app-content">
                <div class="neo-glass" style="text-align:center; padding:1.5rem; margin-bottom:1.5rem;">
                    <div style="font-family:'Orbitron';font-size:1.3rem;color:var(--neo-accent);margin-bottom:0.5rem;">🥉 Bronce</div>
                    <div style="font-size:0.9rem;color:var(--neo-text-secondary);margin-bottom:0.8rem;">Progreso hacia Plata</div>
                    <div style="background:rgba(0,0,0,0.3);height:12px;border-radius:10px;overflow:hidden;margin:0 0.5rem;">
                        <div style="height:100%;background:linear-gradient(90deg,var(--neo-primary),var(--neo-accent));width:56%;"></div>
                    </div>
                    <div style="font-size:0.85rem;color:var(--neo-text);margin-top:0.5rem;">280 / 500 pts</div>
                </div>

                <div class="neo-glass" style="padding:1.2rem; margin-bottom:1.5rem;">
                    <h3 style="font-family:'Rajdhani';color:var(--neo-accent);margin-bottom:1rem;">🎁 Tus Beneficios</h3>
                    <div style="font-size:0.95rem;line-height:1.6;">
                        <div>• Menú digital exclusivo</div>
                        <div>• Cumpleaños gratis</div>
                        <div>• Acceso a eventos del chef</div>
                    </div>
                </div>

                <!-- NUEVO: Funcionalidad para regalar tokens -->
                <div class="neo-glass" style="padding:1.2rem; margin-bottom:1.5rem;">
                    <h3 style="font-family:'Rajdhani';color:var(--neo-accent);margin-bottom:1rem;">🎁 Regalar Tokens</h3>
                    <div class="token-transfer">
                        <input type="number" id="tokenAmount" class="form-control" placeholder="Cantidad" min="1" max="100">
                        <input type="text" id="friendEmail" class="form-control" placeholder="Email del amigo">
                    </div>
                    <button class="btn-neo btn-accent" onclick="transferTokens()">
                        <i class="fas fa-gift"></i> Enviar Tokens
                    </button>
                </div>

                <h3 style="font-family:'Rajdhani';color:var(--neo-accent);margin-bottom:0.8rem;">🛒 Canjear Recompensas</h3>
                <div style="display: grid; gap: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <div><strong>Café Gourmet</strong><br><small>100 pts</small></div>
                        <button style="width:32px;height:32px;border-radius:50%;background:var(--neo-accent);color:var(--neo-bg);border:none;cursor:pointer;" onclick="redeemReward(100, 'Café Gourmet')">
                            <i class="fas fa-gift"></i>
                        </button>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <div><strong>Postre del Chef</strong><br><small>250 pts</small></div>
                        <button style="width:32px;height:32px;border-radius:50%;background:var(--neo-accent);color:var(--neo-bg);border:none;cursor:pointer;" onclick="redeemReward(250, 'Postre del Chef')">
                            <i class="fas fa-gift"></i>
                        </button>
                    </div>
                </div>

                <!-- NUEVO: Funcionalidad para llamar al camarero -->
                <div class="neo-glass" style="padding:1.2rem; margin:1.5rem 0;">
                    <h3 style="font-family:'Rajdhani';color:var(--neo-accent);margin-bottom:1rem;">🛎️ Llamar al Camarero</h3>
                    <button class="btn-neo btn-secondary" id="callWaiterBtn" onclick="callWaiter()">
                        <i class="fas fa-bell"></i> Llamar al Camarero
                    </button>
                    <div id="waiterTimer" style="display:none;">
                        <div class="timer-display" id="timerDisplay">05:00</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div id="waiterOptions" style="display:none; margin-top:1rem;">
                            <p style="text-align:center; color:var(--neo-primary); margin-bottom:1rem;">El camarero no ha llegado. ¿Qué deseas hacer?</p>
                            <button class="btn-neo btn-accent" onclick="callWaiterAgain()">
                                <i class="fas fa-redo"></i> Volver a Llamar
                            </button>
                            <button class="btn-neo" style="background:#e74c3c;color:white;" onclick="callSupervisor()">
                                <i class="fas fa-user-shield"></i> Reclamar al Supervisor
                            </button>
                        </div>
                    </div>
                </div>

                <!-- NUEVO: Formulario para presentar quejas -->
                <div class="complaint-form">
                    <h3 style="font-family:'Rajdhani';color:var(--neo-accent);margin-bottom:1rem;">📝 Presentar Queja</h3>
                    <div class="form-group">
                        <label>Asunto</label>
                        <input type="text" id="complaintSubject" class="form-control" placeholder="Ej: Problema con el servicio">
                    </div>
                    <div class="form-group">
                        <label>Descripción</label>
                        <textarea id="complaintDescription" class="form-control" placeholder="Describe tu queja en detalle..."></textarea>
                    </div>
                    <button class="btn-neo btn-primary" onclick="submitComplaint()">
                        <i class="fas fa-paper-plane"></i> Enviar Queja
                    </button>
                </div>

                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;margin-top:1.5rem;" onclick="showView('homeView')">← Volver</button>
            </div>
        </div>

        <!-- ========== LOGIN EMPLEADOS ========== -->
        <div id="employeeLoginView" class="view">
            <div class="app-header">
                <h1><i class="fas fa-user-tie"></i> Acceso Empleados</h1>
            </div>
            <div class="app-content" style="text-align: center;">
                <div style="margin:2rem 0;">
                    <i class="fas fa-key" style="font-size:3rem;color:var(--neo-primary);"></i>
                    <div style="margin-top:1rem;font-family:'Rajdhani';font-size:1.1rem;">Ingresa tu PIN de empleado</div>
                </div>
                <input type="password" id="employeePin" class="form-control" placeholder="****" style="max-width:200px;margin:0 auto;">
                <button class="btn-neo btn-primary" onclick="loginEmployee()" style="margin-top:1.5rem;">
                    Ingresar
                </button>
                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;margin-top:1rem;" onclick="showView('homeView')">
                    ← Volver
                </button>
            </div>
        </div>

        <!-- ========== PANEL EMPLEADOS ========== -->
        <div id="employeeDashboard" class="view">
            <div class="app-header">
                <h1><i class="fas fa-concierge-bell"></i> Panel Empleados</h1>
            </div>
            <div class="app-content">
                <div class="leaderboard">
                    <div class="leaderboard-title">🏆 TABLERO DE EMPLEADOS</div>
                    <div id="employeeLeaderboard"></div>
                </div>

                <div class="tables-grid" id="tablesGrid"></div>

                <button class="btn-neo" style="background:#3A1525;color:#E0C0D0;margin-top:1.5rem;" onclick="logoutEmployee()">
                    ← Cerrar Sesión
                </button>
            </div>
        </div>

        <!-- ========== PANEL QUANTUM (DUEÑO) ========== -->
        <div id="ownerDashboard" class="view">
            <div class="app-header">
                <h1><i class="fas fa-user-lock"></i> Panel Quantum</h1>
            </div>
            <div class="app-content">
                <div class="neo-glass" style="padding:1rem; margin-bottom:1.5rem;">
                    <div style="font-family:'Orbitron';color:var(--neo-accent);font-size:1.1rem;margin-bottom:0.8rem;">📊 RESUMEN DEL DÍA</div>
                    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:0.6rem;font-size:0.9rem;">
                        <div><strong>Ingresos:</strong> <span id="dailyRevenue">€420</span></div>
                        <div><strong>Mesas ocupadas:</strong> <span id="occupiedTables">8/12</span></div>
                        <div><strong>Pedidos pendientes:</strong> <span id="pendingOrders">3</span></div>
                        <div><strong>Clientes en espera:</strong> <span id="waitingClients">2</span></div>
                    </div>
                </div>

                <div class="leaderboard">
                    <div class="leaderboard-title">⚡ EMPLEADOS DESTACADOS</div>
                    <div id="ownerLeaderboard"></div>
                </div>

                <button class="btn-neo btn-primary" onclick="verifyAllOrders()">
                    ✅ Verificar Todos los Pedidos
                </button>
                <button class="btn-neo" style="background:#e74c3c;color:white;margin-top:1rem;" onclick="logoutOwner()">Cerrar Sesión</button>
            </div>
        </div>
    </div>

    <!-- Navegación Inferior -->
    <div class="app-nav">
        <a href="#" class="nav-item active" onclick="showView('homeView'); return false;">
            <i class="fas fa-home"></i>
            <span>Inicio</span>
        </a>
        <a href="#" class="nav-item" onclick="showView('bookingView'); return false;">
            <i class="fas fa-calendar"></i>
            <span>Reservas</span>
        </a>
        <a href="#" class="nav-item" onclick="showView('menuView'); return false;">
            <i class="fas fa-book"></i>
            <span>Menú</span>
        </a>
        <a href="#" class="nav-item" onclick="showView('qrScannerView'); return false;">
            <i class="fas fa-qrcode"></i>
            <span>Escanear</span>
        </a>
        <a href="#" class="nav-item" onclick="showView('cartView'); return false;" id="cartNavItem">
            <i class="fas fa-shopping-cart"></i>
            <span>Carrito</span>
            <div class="cart-badge" id="cartBadge" style="display: none;">0</div>
        </a>
    </div>

    <script>
        // === ESTADO GLOBAL ===
        let appState = {
            user: null,
            employee: null,
            cart: JSON.parse(localStorage.getItem('gastroneo_cart')) || [],
            employees: [
                { id: 'emp_1', name: 'Carlos Rodríguez', points: 850, level: 'diamante', todayPoints: 45 },
                { id: 'emp_2', name: 'Ana Martínez', points: 720, level: 'oro', todayPoints: 32 },
                { id: 'emp_3', name: 'Luis García', points: 450, level: 'plata', todayPoints: -12 }
            ],
            activities: [],
            waiterTimer: null,
            waiterTimeLeft: 300 // 5 minutos en segundos
        };

        // === INICIALIZACIÓN ===
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                document.getElementById('splashScreen').style.display = 'none';
                initializeApp();
            }, 2500);
        });

        function initializeApp() {
            loadUser();
            updateCartBadge();
            checkMesaEscaneada();
            startLiveActivities();
            renderEmployeeLeaderboard();
            renderTablesGrid();
        }

        // === SISTEMA DE VISTAS ===
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            const viewToNavMap = {
                'homeView': 0, 'bookingView': 1, 'menuView': 2, 'qrScannerView': 3, 'cartView': 4
            };
            
            if (viewToNavMap[viewId] !== undefined) {
                document.querySelectorAll('.nav-item')[viewToNavMap[viewId]].classList.add('active');
            }

            // Acciones específicas por vista
            if (viewId === 'cartView') renderCart();
            if (viewId === 'checkoutView') renderCheckout();
            if (viewId === 'employeeDashboard') renderEmployeeDashboard();
        }

        // === SISTEMA DE USUARIOS ===
        function loadUser() {
            const user = JSON.parse(localStorage.getItem('gastroneo_user'));
            if (user) {
                appState.user = user;
                renderUserProfile();
            } else {
                renderAuthSection();
            }
        }

        function renderUserProfile() {
            const container = document.getElementById('authOrProfile');
            container.innerHTML = `
                <div class="neo-glass" style="padding: 1rem; text-align: center; margin-bottom: 1rem;">
                    <div style="font-family: 'Orbitron'; color: var(--neo-accent); font-size: 1.2rem;">
                        Hola, ${appState.user.name} ✨
                    </div>
                    <div style="color: var(--neo-secondary); margin-top: 0.5rem;">
                        GastroTokens: ${appState.user.tokens || 0}
                    </div>
                </div>
            `;
        }

        function renderAuthSection() {
            const container = document.getElementById('authOrProfile');
            container.innerHTML = `
                <div class="neo-holographic" style="padding: 1.5rem; text-align: center; margin-bottom: 1.5rem; border-radius: 16px;">
                    <div style="font-family: 'Orbitron'; color: var(--neo-accent); font-size: 1.3rem; margin-bottom: 1rem;">
                        ¿NUEVO EN GASTRONEO?
                    </div>
                    <div style="color: var(--neo-text-secondary); margin-bottom: 1.5rem; line-height: 1.5;">
                        Crea tu GastroPass y accede a recompensas exclusivas del futuro.
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="btn-neo btn-accent" onclick="showSignupModal()">
                            Crear Cuenta
                        </button>
                        <button class="btn-neo btn-primary" onclick="showLoginModal()">
                            Iniciar Sesión
                        </button>
                    </div>
                </div>
            `;
        }

        function showSignupModal() {
            const name = prompt("¿Cuál es tu nombre?");
            const email = prompt("¿Cuál es tu email?");
            if (name && email) {
                appState.user = { name: name.trim(), email: email, tokens: 50 };
                localStorage.setItem('gastroneo_user', JSON.stringify(appState.user));
                alert("¡Bienvenido! 🎁 50 GastroTokens de bienvenida.");
                renderUserProfile();
                createNotification('success', '¡Cuenta Creada!', 'Bienvenido a GastroNeo Quantum');
            }
        }

        function showLoginModal() {
            const name = prompt("Ingresa tu nombre:");
            if (name) {
                const existing = JSON.parse(localStorage.getItem('gastroneo_user'));
                if (existing && existing.name === name.trim()) {
                    appState.user = existing;
                    renderUserProfile();
                    alert("¡Bienvenido de nuevo!");
                } else {
                    alert("Usuario no encontrado. Créate una cuenta.");
                }
            }
        }

        // === SISTEMA DE CARRITO ===
        function addToCart(name, price) {
            const existingItem = appState.cart.find(item => item.name === name);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                appState.cart.push({ name, price, quantity: 1 });
            }
            
            localStorage.setItem('gastroneo_cart', JSON.stringify(appState.cart));
            updateCartBadge();
            
            // Efecto visual
            const btn = event.target.closest('.menu-card-btn');
            btn.innerHTML = '<i class="fas fa-check"></i>';
            btn.style.background = 'linear-gradient(135deg, #00D100, #009900)';
            
            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-plus"></i>';
                btn.style.background = 'linear-gradient(135deg, var(--neo-primary), #D10047)';
            }, 1000);
        }

        function updateCartBadge() {
            const badge = document.getElementById('cartBadge');
            const totalItems = appState.cart.reduce((sum, item) => sum + item.quantity, 0);
            
            if (totalItems > 0) {
                badge.textContent = totalItems;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function renderCart() {
            const container = document.getElementById('cartItemsContainer');
            const emptyCart = document.getElementById('emptyCart');
            const cartSummary = document.getElementById('cartSummary');
            const totalAmount = document.getElementById('cartTotalAmount');
            
            if (appState.cart.length === 0) {
                emptyCart.style.display = 'block';
                cartSummary.style.display = 'none';
                container.innerHTML = '';
                return;
            }
            
            emptyCart.style.display = 'none';
            cartSummary.style.display = 'block';
            
            let total = 0;
            container.innerHTML = appState.cart.map(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                return `
                    <div class="cart-item">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--neo-accent);">${item.name}</div>
                            <div style="color: var(--neo-primary);">€${item.price.toFixed(2)} c/u</div>
                        </div>
                        <div class="cart-item-controls">
                            <button class="quantity-btn" onclick="updateQuantity('${item.name}', -1)">-</button>
                            <span style="margin: 0 0.5rem; min-width: 20px; text-align: center;">${item.quantity}</span>
                            <button class="quantity-btn" onclick="updateQuantity('${item.name}', 1)">+</button>
                            <button class="quantity-btn" onclick="removeFromCart('${item.name}')" style="background: #e74c3c;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            totalAmount.textContent = `€${total.toFixed(2)}`;
        }

        function updateQuantity(itemName, change) {
            const item = appState.cart.find(item => item.name === itemName);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(itemName);
                } else {
                    localStorage.setItem('gastroneo_cart', JSON.stringify(appState.cart));
                    updateCartBadge();
                    renderCart();
                }
            }
        }

        function removeFromCart(itemName) {
            appState.cart = appState.cart.filter(item => item.name !== itemName);
            localStorage.setItem('gastroneo_cart', JSON.stringify(appState.cart));
            updateCartBadge();
            renderCart();
        }

        // === CHECKOUT ===
        function renderCheckout() {
            const itemsContainer = document.getElementById('checkoutOrderItems');
            const totalElement = document.getElementById('checkoutTotal');
            
            let total = 0;
            itemsContainer.innerHTML = appState.cart.map(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                return `
                    <div style="display:flex;justify-content:space-between;font-size:0.9rem;margin-bottom:0.5rem;">
                        <span>${item.name} x${item.quantity}</span>
                        <span>€${itemTotal.toFixed(2)}</span>
                    </div>
                `;
            }).join('');
            
            totalElement.textContent = total.toFixed(2);
        }

        function processCheckout() {
            const name = document.getElementById('checkoutName').value;
            const email = document.getElementById('checkoutEmail').value;

            if (!name || !email) {
                alert("Por favor, completa todos los datos.");
                return;
            }

            const total = appState.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Simular pago
            alert(`✅ ¡Pago realizado con éxito!\nTotal: €${total.toFixed(2)}\n\nRecibirás un email de confirmación.`);
            
            // Limpiar carrito
            appState.cart = [];
            localStorage.setItem('gastroneo_cart', JSON.stringify(appState.cart));
            updateCartBadge();
            
            showView('homeView');
        }

        // === GASTROPASS ===
        function redeemReward(cost, item) {
            if (!appState.user) { 
                alert("Crea una cuenta para canjear recompensas."); 
                return; 
            }
            
            if (appState.user.tokens < cost) { 
                alert(`⚠️ Necesitas ${cost} tokens. Tienes ${appState.user.tokens}.`); 
                return; 
            }
            
            appState.user.tokens -= cost;
            localStorage.setItem('gastroneo_user', JSON.stringify(appState.user));
            alert(`✅ ¡Canjeado! ${item}`);
            renderUserProfile();
        }

        // === NUEVAS FUNCIONALIDADES AÑADIDAS ===

        // Transferir tokens a un amigo
        function transferTokens() {
            if (!appState.user) {
                alert("Debes iniciar sesión para transferir tokens.");
                return;
            }
            
            const tokenAmount = parseInt(document.getElementById('tokenAmount').value);
            const friendEmail = document.getElementById('friendEmail').value;
            
            if (!tokenAmount || tokenAmount <= 0) {
                alert("Por favor, ingresa una cantidad válida de tokens.");
                return;
            }
            
            if (!friendEmail || !friendEmail.includes('@')) {
                alert("Por favor, ingresa un email válido.");
                return;
            }
            
            if (tokenAmount > appState.user.tokens) {
                alert(`No tienes suficientes tokens. Tienes ${appState.user.tokens} tokens.`);
                return;
            }
            
            appState.user.tokens -= tokenAmount;
            localStorage.setItem('gastroneo_user', JSON.stringify(appState.user));
            
            alert(`✅ ¡Has enviado ${tokenAmount} tokens a ${friendEmail}!`);
            renderUserProfile();
            
            // Limpiar formulario
            document.getElementById('tokenAmount').value = '';
            document.getElementById('friendEmail').value = '';
        }

        // Llamar al camarero
        function callWaiter() {
            if (!appState.user) {
                alert("Debes iniciar sesión para llamar al camarero.");
                return;
            }
            
            const callBtn = document.getElementById('callWaiterBtn');
            const waiterTimer = document.getElementById('waiterTimer');
            const timerDisplay = document.getElementById('timerDisplay');
            const progressFill = document.getElementById('progressFill');
            const waiterOptions = document.getElementById('waiterOptions');
            
            // Deshabilitar botón y mostrar temporizador
            callBtn.disabled = true;
            callBtn.innerHTML = '<i class="fas fa-bell"></i> Camarero Notificado';
            callBtn.style.background = 'linear-gradient(135deg, #888, #555)';
            waiterTimer.style.display = 'block';
            waiterOptions.style.display = 'none';
            
            // Reiniciar temporizador
            appState.waiterTimeLeft = 300; // 5 minutos
            updateTimerDisplay();
            
            // Iniciar temporizador
            if (appState.waiterTimer) {
                clearInterval(appState.waiterTimer);
            }
            
            appState.waiterTimer = setInterval(() => {
                appState.waiterTimeLeft--;
                updateTimerDisplay();
                
                if (appState.waiterTimeLeft <= 0) {
                    clearInterval(appState.waiterTimer);
                    waiterOptions.style.display = 'block';
                    createNotification('warning', 'Tiempo Agotado', 'El camarero no ha llegado. ¿Qué deseas hacer?');
                }
            }, 1000);
            
            // Notificar al sistema
            createNotification('success', 'Camarero Notificado', 'Un camarero ha sido notificado y llegará en breve.');
            addActivity('positive', `Cliente ${appState.user.name} llamó al camarero`);
        }

        function updateTimerDisplay() {
            const timerDisplay = document.getElementById('timerDisplay');
            const progressFill = document.getElementById('progressFill');
            
            const minutes = Math.floor(appState.waiterTimeLeft / 60);
            const seconds = appState.waiterTimeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const progressPercentage = ((300 - appState.waiterTimeLeft) / 300) * 100;
            progressFill.style.width = `${progressPercentage}%`;
        }

        function callWaiterAgain() {
            const waiterOptions = document.getElementById('waiterOptions');
            waiterOptions.style.display = 'none';
            callWaiter();
        }

        function callSupervisor() {
            const waiterOptions = document.getElementById('waiterOptions');
            waiterOptions.style.display = 'none';
            
            createNotification('danger', 'Supervisor Notificado', 'Un supervisor ha sido notificado y llegará en breve.');
            addActivity('negative', `Cliente ${appState.user.name} reclamó al supervisor`);
            
            // Restablecer botón
            const callBtn = document.getElementById('callWaiterBtn');
            callBtn.disabled = false;
            callBtn.innerHTML = '<i class="fas fa-bell"></i> Llamar al Camarero';
            callBtn.style.background = 'linear-gradient(135deg, var(--neo-secondary), #00B8FF)';
            
            document.getElementById('waiterTimer').style.display = 'none';
        }

        // Presentar queja
        function submitComplaint() {
            if (!appState.user) {
                alert("Debes iniciar sesión para presentar una queja.");
                return;
            }
            
            const subject = document.getElementById('complaintSubject').value;
            const description = document.getElementById('complaintDescription').value;
            
            if (!subject || !description) {
                alert("Por favor, completa todos los campos.");
                return;
            }
            
            // Simular envío de queja
            alert("✅ Tu queja ha sido enviada. Nos pondremos en contacto contigo pronto.");
            
            // Limpiar formulario
            document.getElementById('complaintSubject').value = '';
            document.getElementById('complaintDescription').value = '';
            
            // Notificar al sistema
            createNotification('warning', 'Queja Registrada', 'Hemos recibido tu queja y la estamos revisando.');
            addActivity('negative', `Cliente ${appState.user.name} presentó una queja: ${subject}`);
        }

        // === ESCANER QR ===
        function simulateQRScan() {
            const mesaAleatoria = Math.floor(Math.random() * 12) + 1;
            localStorage.setItem('gastroneo_mesa_escaneada', mesaAleatoria);
            
            alert(`✅ Mesa ${mesaAleatoria} detectada!\nRedirigiendo al menú...`);
            showView('menuView');
        }

        function checkMesaEscaneada() {
            const mesa = localStorage.getItem('gastroneo_mesa_escaneada');
            const mesaInfo = document.getElementById('mesaInfo');
            const currentMesa = document.getElementById('currentMesa');
            const mesaInfoCart = document.getElementById('mesaInfoCart');
            const currentMesaCart = document.getElementById('currentMesaCart');
            
            if (mesa) {
                mesaInfo.style.display = 'block';
                currentMesa.textContent = mesa;
                mesaInfoCart.style.display = 'block';
                currentMesaCart.textContent = mesa;
            }
        }

        // === RESERVAS ===
        function confirmBooking() {
            if (!appState.user) {
                alert("Por favor, crea una cuenta primero.");
                return;
            }

            appState.user.tokens = (appState.user.tokens || 0) + 100;
            localStorage.setItem('gastroneo_user', JSON.stringify(appState.user));
            
            alert("✅ ¡Reserva confirmada!\n+100 GastroTokens.");
            showView('homeView');
        }

        // === EMPLEADOS ===
        function loginEmployee() {
            const pin = document.getElementById('employeePin').value;
            if (pin === "9876") {
                appState.employee = { name: "Empleado Demo", role: "mesero" };
                showView('employeeDashboard');
            } else {
                alert("PIN incorrecto.");
            }
        }

        function logoutEmployee() {
            appState.employee = null;
            showView('homeView');
        }

        function renderEmployeeLeaderboard() {
            const container = document.getElementById('employeeLeaderboard');
            if (!container) return;

            const sortedEmployees = [...appState.employees].sort((a, b) => b.points - a.points);
            
            container.innerHTML = sortedEmployees.map(emp => `
                <div class="leaderboard-item">
                    <div class="rank-badge rank-${emp.level}">${emp.points}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">${emp.name}</div>
                        <div style="font-size: 0.8rem; color: var(--neo-text-secondary);">
                            ${emp.level.toUpperCase()} 
                            ${emp.todayPoints !== 0 ? 
                                `<span style="color: ${emp.todayPoints > 0 ? '#00FF00' : '#FF4444'};">
                                    ${emp.todayPoints > 0 ? '+' : ''}${emp.todayPoints}
                                </span>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderTablesGrid() {
            const grid = document.getElementById('tablesGrid');
            if (!grid) return;

            grid.innerHTML = '';
            for (let i = 1; i <= 12; i++) {
                const status = i <= 8 ? 'occupied' : 'free';
                const card = document.createElement('div');
                card.className = `table-card table-${status}`;
                card.innerHTML = `
                    <div style="font-size: 1.2rem; font-weight: 700;">${i}</div>
                    <div style="font-size: 0.7rem;">${status === 'free' ? 'Libre' : 'Ocupada'}</div>
                `;
                card.onclick = () => openTableDetail(i, status);
                grid.appendChild(card);
            }
        }

        function openTableDetail(tableNum, status) {
            alert(`Mesa ${tableNum} - ${status === 'free' ? 'Libre' : 'Ocupada'}`);
        }

        // === PANEL QUANTUM (DUEÑO) ===
        function openOwnerAccess() {
            const pin = prompt("🔐 PIN QUANTUM (demo: 1234):");
            if (pin === "1234") {
                showView('ownerDashboard');
            } else if (pin) {
                alert("⚠️ PIN incorrecto.");
            }
        }

        function logoutOwner() {
            showView('homeView');
        }

        function verifyAllOrders() {
            alert("✅ Todos los pedidos verificados y actualizados.");
        }

        // === ACTIVIDAD EN VIVO ===
        function startLiveActivities() {
            // Actividades iniciales
            addActivity('positive', 'Sistema GastroNeo Quantum iniciado');
            addActivity('positive', '3 nuevas reservas esta mañana');
            
            // Simular actividad cada 20 segundos
            setInterval(() => {
                const activities = [
                    'positive: Carlos +10pts: Cliente elogió servicio',
                    'positive: Ana +8pts: Upselling exitoso',
                    'negative: Luis -12pts: Tiempo excedido',
                    'positive: Sistema: Pedido completado Mesa 5'
                ];
                const randomActivity = activities[Math.floor(Math.random() * activities.length)];
                const [type, message] = randomActivity.split(': ');
                addActivity(type, message);
            }, 20000);
        }

        function addActivity(type, message) {
            const activity = {
                id: Date.now(),
                type: type,
                message: message,
                timestamp: new Date().toLocaleTimeString()
            };
            
            appState.activities.unshift(activity);
            appState.activities = appState.activities.slice(0, 5); // Mantener solo 5
            renderActivityFeed();
        }

        function renderActivityFeed() {
            const feed = document.getElementById('liveActivityFeed');
            if (!feed) return;
            
            feed.innerHTML = appState.activities.map(activity => `
                <div class="activity-item activity-${activity.type}">
                    <div>${activity.message}</div>
                    <div style="font-size: 0.7rem; color: var(--neo-text-secondary); margin-top: 0.2rem;">
                        ${activity.timestamp}
                    </div>
                </div>
            `).join('');
        }

        // === NOTIFICACIONES ===
        function createNotification(type, title, message) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <div style="font-family: 'Orbitron'; font-weight: 700;">${title}</div>
                    <div style="font-size: 0.8rem; color: var(--neo-text-secondary);">Ahora</div>
                </div>
                <div style="font-size: 0.85rem;">${message}</div>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>
